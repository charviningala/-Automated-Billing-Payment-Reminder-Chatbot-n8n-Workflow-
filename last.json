{
  "name": "My workflow",
  "nodes": [
    {
      "parameters": {
        "updates": [
          "message"
        ],
        "additionalFields": {}
      },
      "type": "n8n-nodes-base.telegramTrigger",
      "typeVersion": 1.2,
      "position": [
        -100,
        0
      ],
      "id": "4ef59ad3-d604-4a23-92a9-31183c142b05",
      "name": "Telegram Trigger",
      "webhookId": "e345d1f7-6843-4e08-a385-7c3839dd9ae3",
      "credentials": {
        "telegramApi": {
          "id": "RpCZHGbo8GY97ml6",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "loose",
                  "version": 2
                },
                "conditions": [
                  {
                    "leftValue": "={{ $json.message.document }}",
                    "rightValue": "1",
                    "operator": {
                      "type": "object",
                      "operation": "exists",
                      "singleValue": true
                    },
                    "id": "2e3df940-013d-47d8-9bf2-519a916bd068"
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "Document"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "loose",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "8f6fb9f7-c8eb-4a99-b05b-8d39fdd3552f",
                    "leftValue": "={{ $json.message.sticker }}",
                    "rightValue": "2",
                    "operator": {
                      "type": "object",
                      "operation": "exists",
                      "singleValue": true
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "Image"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "loose",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "f08f9fbb-3859-45aa-b06d-114d0bfc1244",
                    "leftValue": "={{ $json.message.text }}",
                    "rightValue": "",
                    "operator": {
                      "type": "string",
                      "operation": "exists",
                      "singleValue": true
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "text"
            }
          ]
        },
        "looseTypeValidation": true,
        "options": {}
      },
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3.2,
      "position": [
        220,
        0
      ],
      "id": "9933d617-abc3-41fe-9b23-e91a743d39df",
      "name": "Switch"
    },
    {
      "parameters": {
        "chatId": "={{ $('Telegram Trigger').item.json.message.from.id }}",
        "text": "Received Invoice, its in process now.",
        "additionalFields": {}
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        1060,
        0
      ],
      "id": "16417b5a-5cff-4a55-b48d-048bd95dba5d",
      "name": "Telegram",
      "webhookId": "545250a4-8c8c-4d05-b2b6-fb44523a2741",
      "credentials": {
        "telegramApi": {
          "id": "RpCZHGbo8GY97ml6",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "resource": "file",
        "fileId": "={{ $('Switch').item.json.message.sticker.file_id }}"
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        1260,
        0
      ],
      "id": "4d1dcecf-5047-4b3b-8357-0f53dc2d671c",
      "name": "Telegram1",
      "webhookId": "d1e9d175-5343-4eaf-941b-739c2f45b221",
      "credentials": {
        "telegramApi": {
          "id": "RpCZHGbo8GY97ml6",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "url": "=https://api.cloud.llamaindex.ai/api/parsing/job/{{ $json.id }}",
        "authentication": "genericCredentialType",
        "genericAuthType": "httpHeaderAuth",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "accept",
              "value": "application/json"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        1700,
        0
      ],
      "id": "f173fb90-62d1-461c-990d-acb53f1e17de",
      "name": "Get Processing Status",
      "credentials": {
        "httpHeaderAuth": {
          "id": "vdUQryoL0T0HV67U",
          "name": "Header Auth account 4"
        }
      }
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://api.cloud.llamaindex.ai/api/parsing/upload",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "Authorization",
              "value": "Bearer llx-LsyspGPR00MQ80uKQCJ3uh6VWSFKbDjM5rSC1Nf8rrDpTibe"
            }
          ]
        },
        "sendBody": true,
        "contentType": "multipart-form-data",
        "bodyParameters": {
          "parameters": [
            {
              "parameterType": "formBinaryData",
              "name": "file",
              "inputDataFieldName": "data"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        1480,
        0
      ],
      "id": "32eba85e-1836-46d7-86c2-8f89117c7621",
      "name": "Upload to Llama Parse"
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "leftValue": "={{ $json.status }}",
                    "rightValue": "SUCCESS",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    },
                    "id": "0d527f5a-4fae-4299-845a-e13223c9e662"
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "Success"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "bc25fbd0-c7d7-42bb-8788-1f47276ff25f",
                    "leftValue": "={{ $json.status }}",
                    "rightValue": "ERROR",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "Error"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "61a2c88e-a687-4d61-ae5b-a3c90ef1bba3",
                    "leftValue": "={{ $json.status }}",
                    "rightValue": "CANCELLED",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "Cancelled"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "020f1a96-00b5-40ef-bc9e-d0b733da03f5",
                    "leftValue": "={{ $json.status }}",
                    "rightValue": "PENDING",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "Pending"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3.2,
      "position": [
        1920,
        0
      ],
      "id": "c4bf16e9-8aa0-4e0f-83a5-a80e72fcfdf2",
      "name": "Switch1"
    },
    {
      "parameters": {
        "amount": 30
      },
      "type": "n8n-nodes-base.wait",
      "typeVersion": 1.1,
      "position": [
        2200,
        80
      ],
      "id": "7dc4aab1-f288-49be-b7f1-ea20031a11a6",
      "name": "Wait",
      "webhookId": "da6c950e-1a70-4cee-bdce-92da85f9fb9b"
    },
    {
      "parameters": {
        "url": "=https://api.cloud.llamaindex.ai/api/parsing/job/{{$json.id}}/result/markdown\n\n ",
        "authentication": "genericCredentialType",
        "genericAuthType": "httpHeaderAuth",
        "options": {
          "redirect": {
            "redirect": {}
          }
        }
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        2240,
        -80
      ],
      "id": "0c92958a-e8d3-4348-b142-3210217486e7",
      "name": "Get Parsed Invoice Data",
      "credentials": {
        "httpHeaderAuth": {
          "id": "vdUQryoL0T0HV67U",
          "name": "Header Auth account 4"
        }
      }
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "={{ $json.markdown }}",
        "messages": {
          "messageValues": [
            {
              "message": "\n### **ROLE DEFINITION**\n\nYOU ARE THE WORLD'S LEADING EXPERT IN DOCUMENT DATA EXTRACTION AND PROCESSING, SPECIALIZING IN ACCURATELY IDENTIFYING AND STRUCTURING DETAILS FROM INVOICES. YOUR TASK IS TO EXTRACT *ALL* RELEVANT FIELDS FROM ANY GIVEN INVOICE TEXT AND RETURN THEM IN A WELL-STRUCTURED JSON FORMAT FOR EASY PARSING AND ANALYSIS.\n\n---\n\n### **INSTRUCTIONS**\n\n1. **UNDERSTAND THE INPUT**\n\n   * Carefully parse the provided invoice text (plain text, scanned OCR, or structured block) to identify key details.\n\n2. **FOCUS ON ALL RELEVANT FIELDS**\n   Extract as many of the following commonly used invoice fields as are present:\n\n   * **invoice\\_number**: Unique identifier marked as invoice number.\n   * **invoice\\_date**: The date the invoice was issued.\n   * **due\\_date**: The payment due date, if available.\n   * **seller**: The name and contact details of the issuing company.\n   * **buyer**: The name and contact details of the billed party.\n   * **items**: A list of line items in the invoice, each including:\n\n     * **description**\n     * **quantity**\n     * **unit\\_price**\n     * **total\\_price**\n   * **subtotal**: Total before tax and additional charges.\n   * **tax**: Amount of tax charged.\n   * **total\\_amount**: Grand total payable including taxes.\n   * **currency**: If mentioned (e.g., USD, EUR, ₹).\n   * **payment\\_terms**: Payment conditions (e.g., Net 30, Due on Receipt).\n   * **notes**: Any additional notes, comments, or terms.\n   * **purchase\\_order\\_number**: If referenced.\n   * **tax\\_id**: VAT/GST number or other tax registration info.\n   * **bank\\_details**: If provided for payment.\n\n3. **RETURN STRUCTURED JSON OUTPUT**\n   Use the following JSON schema. Set any unavailable field to `null`. Always include all keys:\n\n   ```json\n   {\n     \"invoice_number\": \"<string or null>\",\n     \"invoice_date\": \"<YYYY-MM-DD or format in input or null>\",\n     \"due_date\": \"<string or null>\",\n     \"seller\": \"<string or null>\",\n     \"buyer\": \"<string or null>\",\n     \"items\": [\n       {\n         \"description\": \"<string or null>\",\n         \"quantity\": \"<number or null>\",\n         \"unit_price\": \"<string or null>\",\n         \"total_price\": \"<string or null>\"\n       }\n     ],\n     \"subtotal\": \"<string or null>\",\n     \"tax\": \"<string or null>\",\n     \"total_amount\": \"<string or null>\",\n     \"currency\": \"<string or null>\",\n     \"payment_terms\": \"<string or null>\",\n     \"notes\": \"<string or null>\",\n     \"purchase_order_number\": \"<string or null>\",\n     \"tax_id\": \"<string or null>\",\n     \"bank_details\": \"<string or null>\"\n   }\n   ```\n\n4. **CHAIN OF THOUGHT: STEP-BY-STEP STRATEGY**\n\n   * **PARSE INPUT TEXT**\n\n     * Use headings, labels, and contextual indicators (e.g., \"Invoice No.\", \"Bill To:\", \"Total:\") to identify field boundaries.\n   * **VALIDATE & FORMAT**\n\n     * Ensure numeric and date formats are valid and consistent.\n     * Strip irrelevant prefixes (e.g., `USD`, `INR`) into a separate `currency` field.\n   * **POPULATE JSON**\n\n     * For line items, each should have individual details as available.\n     * Set any missing or unclear field to `null`.\n   * **FINAL CHECK**\n\n     * Ensure JSON is valid and contains all listed keys.\n\n---\n\n### **STRICT RULES**\n\n* **DO NOT GUESS** or fabricate data for any missing field.\n* **DO NOT OMIT** any fields from the JSON — use `null` if unknown.\n* **DO NOT ADD** extra fields beyond the defined schema.\n* **DO NOT** change number or date formatting from the original unless required for standardization.\n\n\n\n\n\n"
            }
          ]
        }
      },
      "type": "@n8n/n8n-nodes-langchain.chainLlm",
      "typeVersion": 1.6,
      "position": [
        2440,
        -80
      ],
      "id": "c2dda509-a7b8-4d80-aa28-098d4aa5fde8",
      "name": "Basic LLM Chain",
      "alwaysOutputData": true
    },
    {
      "parameters": {
        "modelName": "models/gemini-1.5-flash-latest",
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatGoogleGemini",
      "typeVersion": 1,
      "position": [
        2460,
        80
      ],
      "id": "83ffd254-d244-4dec-8b7d-acd5255eadfc",
      "name": "Google Gemini Chat Model",
      "credentials": {
        "googlePalmApi": {
          "id": "oX6GN6LX2hphLuiB",
          "name": "Google Gemini(PaLM) Api account"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "const raw = $json[\"text\"] || $json[\"choices\"]?.[0]?.text;\n\n// Try to extract JSON inside code block\nconst match = raw.match(/\\{[\\s\\S]*\\}/);\n\nif (!match) {\n  throw new Error(\"No valid JSON object found in LLM response.\");\n}\n\nlet parsed;\ntry {\n  parsed = JSON.parse(match[0]);\n} catch (e) {\n  throw new Error(\"Failed to parse extracted JSON.\");\n}\n\nreturn [{ json: parsed }];"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        2820,
        -80
      ],
      "id": "284c6f88-253e-4de9-9956-321bd5870c21",
      "name": "Code"
    },
    {
      "parameters": {
        "operation": "append",
        "documentId": {
          "__rl": true,
          "value": "1lc3qFWiDDh_51-_iCbBtzJzDIui4lUHkkbF_zOkJn04",
          "mode": "list",
          "cachedResultName": "invoice",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lc3qFWiDDh_51-_iCbBtzJzDIui4lUHkkbF_zOkJn04/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": "gid=0",
          "mode": "list",
          "cachedResultName": "Sheet1",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lc3qFWiDDh_51-_iCbBtzJzDIui4lUHkkbF_zOkJn04/edit#gid=0"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "Invoice No": "={{ $json.invoice_number }}",
            "Invoice Date": "={{ $json.invoice_date }}",
            "Due Date": "={{ $json.due_date }}",
            "Sender Address": "={{ $json.seller }}",
            "Sub Total": "={{ $json.subtotal }}",
            "Tax": "={{ $json.tax }}",
            "Total Amount": "={{ $json.total_amount }}",
            "Items": "={{ $json.items }}",
            "Receiver Address": "={{ $json.buyer }}"
          },
          "matchingColumns": [],
          "schema": [
            {
              "id": "Invoice No",
              "displayName": "Invoice No",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "Invoice Date",
              "displayName": "Invoice Date",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "Due Date",
              "displayName": "Due Date",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "Sender Address",
              "displayName": "Sender Address",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "Sender Phone No",
              "displayName": "Sender Phone No",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "Sender Email",
              "displayName": "Sender Email",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "Sender  Banking details",
              "displayName": "Sender  Banking details",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "Receiver Address",
              "displayName": "Receiver Address",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "Receiver Phone No",
              "displayName": "Receiver Phone No",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "Receiver Email",
              "displayName": "Receiver Email",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "Items",
              "displayName": "Items",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "Sub Total",
              "displayName": "Sub Total",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "Tax",
              "displayName": "Tax",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "Total Amount",
              "displayName": "Total Amount",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "Payment Status",
              "displayName": "Payment Status",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.6,
      "position": [
        3040,
        -80
      ],
      "id": "2f8ed45b-396e-4435-8c7e-dfea9e219010",
      "name": "Google Sheets",
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "0QjhWLxNEbbsYTKu",
          "name": "Google Sheets account 3"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $('Telegram').item.json.result.chat.id }}",
        "text": "=Please Check & Confirm:\n\nInvoice Number: {{ $('Code').item.json.invoice_number }}\nInvoice Date:{{ $('Code').item.json.invoice_date }}\nTotal Amount:{{ $('Code').item.json.total_amount }}\nTax:{{ $('Code').item.json.tax }}\n\nAll data correct?",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        3260,
        -80
      ],
      "id": "20081381-2137-482a-8291-a1810d112053",
      "name": "Telegram2",
      "webhookId": "a930ccc6-9617-42f2-8c4c-9f167f79cc53",
      "credentials": {
        "telegramApi": {
          "id": "RpCZHGbo8GY97ml6",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $json.message.chat.id }}",
        "text": "Received Invoice, its in process now.",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        980,
        -220
      ],
      "id": "df327440-5c5a-4326-8341-21cd5e319e76",
      "name": "Telegram8",
      "webhookId": "545250a4-8c8c-4d05-b2b6-fb44523a2741",
      "credentials": {
        "telegramApi": {
          "id": "RpCZHGbo8GY97ml6",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "resource": "file",
        "fileId": "={{ $('Telegram Trigger').item.json.message.document.file_id }}"
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        1280,
        -220
      ],
      "id": "f8e8e3cd-a131-4d9a-b651-1dd6ce5d6ea0",
      "name": "Telegram9",
      "webhookId": "d1e9d175-5343-4eaf-941b-739c2f45b221",
      "credentials": {
        "telegramApi": {
          "id": "RpCZHGbo8GY97ml6",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "url": "=https://api.cloud.llamaindex.ai/api/parsing/job/{{ $json.id }}",
        "authentication": "genericCredentialType",
        "genericAuthType": "httpHeaderAuth",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "accept",
              "value": "application/json"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        1760,
        -280
      ],
      "id": "f4505bcf-32fe-4f67-98ca-830b3700a36d",
      "name": "Get Processing Status2",
      "credentials": {
        "httpHeaderAuth": {
          "id": "vdUQryoL0T0HV67U",
          "name": "Header Auth account 4"
        }
      }
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://api.cloud.llamaindex.ai/api/parsing/upload",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "Authorization",
              "value": "Bearer llx-LsyspGPR00MQ80uKQCJ3uh6VWSFKbDjM5rSC1Nf8rrDpTibe"
            }
          ]
        },
        "sendBody": true,
        "contentType": "multipart-form-data",
        "bodyParameters": {
          "parameters": [
            {
              "parameterType": "formBinaryData",
              "name": "file",
              "inputDataFieldName": "data"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        1520,
        -220
      ],
      "id": "96da590d-8ba3-4295-8ca5-29e338a9b84d",
      "name": "Upload to Llama Parse2"
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "leftValue": "={{ $json.status }}",
                    "rightValue": "SUCCESS",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    },
                    "id": "0d527f5a-4fae-4299-845a-e13223c9e662"
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "Success"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "bc25fbd0-c7d7-42bb-8788-1f47276ff25f",
                    "leftValue": "={{ $json.status }}",
                    "rightValue": "ERROR",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "Error"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "61a2c88e-a687-4d61-ae5b-a3c90ef1bba3",
                    "leftValue": "={{ $json.status }}",
                    "rightValue": "CANCELLED",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "Cancelled"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "020f1a96-00b5-40ef-bc9e-d0b733da03f5",
                    "leftValue": "={{ $json.status }}",
                    "rightValue": "PENDING",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "Pending"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3.2,
      "position": [
        2000,
        -300
      ],
      "id": "8e94d165-bb64-4088-905d-acf4ed49e49a",
      "name": "Switch3"
    },
    {
      "parameters": {
        "amount": 30
      },
      "type": "n8n-nodes-base.wait",
      "typeVersion": 1.1,
      "position": [
        2300,
        -300
      ],
      "id": "504e10fd-8cbe-41bb-bba6-d037d56ea098",
      "name": "Wait2",
      "webhookId": "da6c950e-1a70-4cee-bdce-92da85f9fb9b"
    },
    {
      "parameters": {
        "url": "=https://api.cloud.llamaindex.ai/api/parsing/job/{{ $json.id }}/result/markdown\n\n ",
        "authentication": "genericCredentialType",
        "genericAuthType": "httpHeaderAuth",
        "options": {
          "redirect": {
            "redirect": {}
          }
        }
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        2300,
        -420
      ],
      "id": "82f96141-d69e-4c32-94e0-ff8e01a027c5",
      "name": "Get Parsed Invoice Data2",
      "credentials": {
        "httpHeaderAuth": {
          "id": "vdUQryoL0T0HV67U",
          "name": "Header Auth account 4"
        }
      }
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "={{ $json.markdown }}",
        "messages": {
          "messageValues": [
            {
              "message": "=\n### **ROLE DEFINITION**\n\nYOU ARE THE WORLD'S LEADING EXPERT IN DOCUMENT DATA EXTRACTION AND PROCESSING, SPECIALIZING IN ACCURATELY IDENTIFYING AND STRUCTURING DETAILS FROM INVOICES. YOUR TASK IS TO EXTRACT *ALL* RELEVANT FIELDS FROM ANY GIVEN INVOICE TEXT AND RETURN THEM IN A WELL-STRUCTURED JSON FORMAT FOR EASY PARSING AND ANALYSIS.\n\n---\n\n### **INSTRUCTIONS**\n\n1. **UNDERSTAND THE INPUT**\n\n   * Carefully parse the provided invoice text (plain text, scanned OCR, or structured block) to identify key details.\n\n2. **FOCUS ON ALL RELEVANT FIELDS**\n   Extract as many of the following commonly used invoice fields as are present:\n\n   * **invoice\\_number**: Unique identifier marked as invoice number.\n   * **invoice\\_date**: The date the invoice was issued.\n   * **due\\_date**: The payment due date, if available.\n   * **seller**: The name and contact details of the issuing company.\n   * **buyer**: The name and contact details of the billed party.\n   * **items**: A list of line items in the invoice, each including:\n\n     * **description**\n     * **quantity**\n     * **unit\\_price**\n     * **total\\_price**\n   * **subtotal**: Total before tax and additional charges.\n   * **tax**: Amount of tax charged.\n   * **total\\_amount**: Grand total payable including taxes.\n   * **currency**: If mentioned (e.g., USD, EUR, ₹).\n   * **payment\\_terms**: Payment conditions (e.g., Net 30, Due on Receipt).\n   * **notes**: Any additional notes, comments, or terms.\n   * **purchase\\_order\\_number**: If referenced.\n   * **tax\\_id**: VAT/GST number or other tax registration info.\n   * **bank\\_details**: If provided for payment.\n\n3. **RETURN STRUCTURED JSON OUTPUT**\n   Use the following JSON schema. Set any unavailable field to `null`. Always include all keys:\n\n   ```json\n   {\n     \"invoice_number\": \"<string or null>\",\n     \"invoice_date\": \"<YYYY-MM-DD or format in input or null>\",\n     \"due_date\": \"<string or null>\",\n     \"seller\": \"<string or null>\",\n     \"buyer\": \"<string or null>\",\n     \"items\": [\n       {\n         \"description\": \"<string or null>\",\n         \"quantity\": \"<number or null>\",\n         \"unit_price\": \"<string or null>\",\n         \"total_price\": \"<string or null>\"\n       }\n     ],\n     \"subtotal\": \"<string or null>\",\n     \"tax\": \"<string or null>\",\n     \"total_amount\": \"<string or null>\",\n     \"currency\": \"<string or null>\",\n     \"payment_terms\": \"<string or null>\",\n     \"notes\": \"<string or null>\",\n     \"purchase_order_number\": \"<string or null>\",\n     \"tax_id\": \"<string or null>\",\n     \"bank_details\": \"<string or null>\"\n   }\n   ```\n\n4. **CHAIN OF THOUGHT: STEP-BY-STEP STRATEGY**\n\n   * **PARSE INPUT TEXT**\n\n     * Use headings, labels, and contextual indicators (e.g., \"Invoice No.\", \"Bill To:\", \"Total:\") to identify field boundaries.\n   * **VALIDATE & FORMAT**\n\n     * Ensure numeric and date formats are valid and consistent.\n     * Strip irrelevant prefixes (e.g., `USD`, `INR`) into a separate `currency` field.\n   * **POPULATE JSON**\n\n     * For line items, each should have individual details as available.\n     * Set any missing or unclear field to `null`.\n   * **FINAL CHECK**\n\n     * Ensure JSON is valid and contains all listed keys.\n\n---\n\n### **STRICT RULES**\n\n* **DO NOT GUESS** or fabricate data for any missing field.\n* **DO NOT OMIT** any fields from the JSON — use `null` if unknown.\n* **DO NOT ADD** extra fields beyond the defined schema.\n* **DO NOT** change number or date formatting from the original unless required for standardization.\n\n"
            }
          ]
        }
      },
      "type": "@n8n/n8n-nodes-langchain.chainLlm",
      "typeVersion": 1.6,
      "position": [
        2560,
        -420
      ],
      "id": "fea44c94-7c0d-4ead-89c0-fa8321d2a850",
      "name": "Basic LLM Chain2",
      "alwaysOutputData": true
    },
    {
      "parameters": {
        "modelName": "models/gemini-1.5-flash-latest",
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatGoogleGemini",
      "typeVersion": 1,
      "position": [
        2560,
        -280
      ],
      "id": "f6da5479-3808-44c9-b986-f3acdab34838",
      "name": "Google Gemini Chat Model2",
      "credentials": {
        "googlePalmApi": {
          "id": "oX6GN6LX2hphLuiB",
          "name": "Google Gemini(PaLM) Api account"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "const raw = $json[\"text\"] || $json[\"choices\"]?.[0]?.text;\n\n// Try to extract JSON inside code block\nconst match = raw.match(/\\{[\\s\\S]*\\}/);\n\nif (!match) {\n  throw new Error(\"No valid JSON object found in LLM response.\");\n}\n\nlet parsed;\ntry {\n  parsed = JSON.parse(match[0]);\n} catch (e) {\n  throw new Error(\"Failed to parse extracted JSON.\");\n}\n\nreturn [{ json: parsed }];"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        2920,
        -420
      ],
      "id": "ad559ed7-9853-407f-885a-04ed89948d6f",
      "name": "Code2"
    },
    {
      "parameters": {
        "operation": "append",
        "documentId": {
          "__rl": true,
          "value": "1lc3qFWiDDh_51-_iCbBtzJzDIui4lUHkkbF_zOkJn04",
          "mode": "list",
          "cachedResultName": "invoice",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lc3qFWiDDh_51-_iCbBtzJzDIui4lUHkkbF_zOkJn04/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": "gid=0",
          "mode": "list",
          "cachedResultName": "Sheet1",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lc3qFWiDDh_51-_iCbBtzJzDIui4lUHkkbF_zOkJn04/edit#gid=0"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "Invoice No": "={{ $json.invoice_number }}",
            "Invoice Date": "={{ $json.invoice_date }}",
            "Due Date": "={{ $json.due_date }}",
            "Sender Address": "={{ $json.seller }}",
            "Sender  Banking details": "={{ $json.bank_details }}",
            "Receiver Address": "={{ $json.buyer }}",
            "Sub Total": "={{ $json.subtotal }}",
            "Tax": "={{ $json.tax }}",
            "Total Amount": "={{ $json.total_amount }}",
            "Items": "={{ $json.items }}"
          },
          "matchingColumns": [],
          "schema": [
            {
              "id": "Invoice No",
              "displayName": "Invoice No",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "Invoice Date",
              "displayName": "Invoice Date",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "Due Date",
              "displayName": "Due Date",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "Sender Address",
              "displayName": "Sender Address",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "Sender Phone No",
              "displayName": "Sender Phone No",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "Sender Email",
              "displayName": "Sender Email",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "Sender  Banking details",
              "displayName": "Sender  Banking details",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "Receiver Address",
              "displayName": "Receiver Address",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "Receiver Phone No",
              "displayName": "Receiver Phone No",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "Receiver Email",
              "displayName": "Receiver Email",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "Items",
              "displayName": "Items",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "Sub Total",
              "displayName": "Sub Total",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "Tax",
              "displayName": "Tax",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "Total Amount",
              "displayName": "Total Amount",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "Payment Status",
              "displayName": "Payment Status",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.6,
      "position": [
        3160,
        -420
      ],
      "id": "72088c76-5a8e-413c-8f91-c4f15315e7bd",
      "name": "Google Sheets1",
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "0QjhWLxNEbbsYTKu",
          "name": "Google Sheets account 3"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $('Telegram Trigger').item.json.message.chat.id }}",
        "text": "=Please Check & Confirm:\n\nInvoice Number:{{ $json.Invoice_number }} \nInvoice Date:{{ $json['Invoice Date'] }}\nTotal Amount:{{ $json['Total amount'] }}\nTax:{{ $json.Tax }}\n\nAll data correct?",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        3320,
        -420
      ],
      "id": "9ae2b1bc-9f92-49cb-ba36-94fb889332b0",
      "name": "Telegram4",
      "webhookId": "a930ccc6-9617-42f2-8c4c-9f167f79cc53",
      "credentials": {
        "telegramApi": {
          "id": "RpCZHGbo8GY97ml6",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "operation": "delete",
        "documentId": {
          "__rl": true,
          "value": "1lc3qFWiDDh_51-_iCbBtzJzDIui4lUHkkbF_zOkJn04",
          "mode": "list",
          "cachedResultName": "invoice",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lc3qFWiDDh_51-_iCbBtzJzDIui4lUHkkbF_zOkJn04/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": "gid=0",
          "mode": "list",
          "cachedResultName": "Sheet1",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lc3qFWiDDh_51-_iCbBtzJzDIui4lUHkkbF_zOkJn04/edit#gid=0"
        },
        "startIndex": "={{ $items().length + 1 }}"
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.6,
      "position": [
        1720,
        380
      ],
      "id": "42f3e690-2a3b-452d-b701-eba006b366a0",
      "name": "Google Sheets3",
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "0QjhWLxNEbbsYTKu",
          "name": "Google Sheets account 3"
        }
      }
    },
    {
      "parameters": {
        "type": "code",
        "code": "return items.sort((a, b) => {\n  const dateA = new Date(a.json.invoice_date);\n  const dateB = new Date(b.json.invoice_date);\n  return dateB - dateA;\n});\n"
      },
      "type": "n8n-nodes-base.sort",
      "typeVersion": 1,
      "position": [
        2160,
        380
      ],
      "id": "e5e1b80e-4e7e-4a6e-adb9-21e1bf71ca2f",
      "name": "Sort"
    },
    {
      "parameters": {},
      "type": "n8n-nodes-base.limit",
      "typeVersion": 1,
      "position": [
        2380,
        380
      ],
      "id": "6b939177-e6d6-45a0-8073-0f3aa92f6755",
      "name": "Limit"
    },
    {
      "parameters": {
        "operation": "deleteFile",
        "fileId": {
          "__rl": true,
          "value": "={{ $json.id }}",
          "mode": "id"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleDrive",
      "typeVersion": 3,
      "position": [
        2600,
        380
      ],
      "id": "f587dae1-704e-4a95-bcd1-ad34e7d17cf1",
      "name": "Google Drive3",
      "credentials": {
        "googleDriveOAuth2Api": {
          "id": "RHe6oZ7QoI8mqv4g",
          "name": "Google Drive account"
        }
      }
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "251e9c48-7af7-460f-9ce5-464a9e283b51",
              "name": "message.text",
              "value": "={{ $json.message.text }}",
              "type": "string"
            },
            {
              "id": "17e1df97-71a9-4869-ace5-c8f3192d4fab",
              "name": "message.chat.id",
              "value": "={{ $json.message.chat.id }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        1360,
        640
      ],
      "id": "b5407031-2548-402a-8480-32ac59a7007b",
      "name": "Edit Fields"
    },
    {
      "parameters": {
        "documentId": {
          "__rl": true,
          "value": "1lc3qFWiDDh_51-_iCbBtzJzDIui4lUHkkbF_zOkJn04",
          "mode": "list",
          "cachedResultName": "invoice",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lc3qFWiDDh_51-_iCbBtzJzDIui4lUHkkbF_zOkJn04/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": "gid=0",
          "mode": "list",
          "cachedResultName": "Sheet1",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lc3qFWiDDh_51-_iCbBtzJzDIui4lUHkkbF_zOkJn04/edit#gid=0"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.6,
      "position": [
        1580,
        640
      ],
      "id": "35a640ed-8b0d-45af-8bf1-f6126bcb6feb",
      "name": "Google Sheets4",
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "0QjhWLxNEbbsYTKu",
          "name": "Google Sheets account 3"
        }
      }
    },
    {
      "parameters": {},
      "type": "n8n-nodes-base.limit",
      "typeVersion": 1,
      "position": [
        1800,
        640
      ],
      "id": "850ce307-4b55-4b0c-9309-c6efbcdcff9d",
      "name": "Limit1"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "bd2e1cad-544e-4d02-9d98-568ace98d93c",
              "name": "Invoice_number",
              "value": "={{ $json.Invoice_number }}",
              "type": "string"
            },
            {
              "id": "78a1642d-3f7d-4516-a8ca-772ecced2e33",
              "name": "Invoice Date",
              "value": "={{ $json['Invoice Date'] }}",
              "type": "string"
            },
            {
              "id": "e4102174-4100-4cbc-9c07-b1fdd124e8c0",
              "name": "Total amount",
              "value": "={{ $json['Total amount'] }}",
              "type": "number"
            },
            {
              "id": "5e6be7f5-2dbc-457e-b85d-2fe18c2ed894",
              "name": "Tax",
              "value": "={{ $json.Tax }}",
              "type": "number"
            },
            {
              "id": "f4a38cf5-bea0-4ee1-9673-485b9be37a14",
              "name": "Payment Method",
              "value": "={{ $('Edit Fields').item.json.message.text }}",
              "type": "string"
            },
            {
              "id": "b5fd5645-4598-48f6-981e-a1b64bc3a348",
              "name": "row_number",
              "value": "={{ $json.row_number }}",
              "type": "number"
            }
          ]
        },
        "options": {
          "ignoreConversionErrors": true
        }
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        2020,
        640
      ],
      "id": "6e2edf16-b1f6-44da-b424-098a7f7fc2e2",
      "name": "Edit Fields1"
    },
    {
      "parameters": {
        "operation": "update",
        "documentId": {
          "__rl": true,
          "value": "1lc3qFWiDDh_51-_iCbBtzJzDIui4lUHkkbF_zOkJn04",
          "mode": "list",
          "cachedResultName": "invoice",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lc3qFWiDDh_51-_iCbBtzJzDIui4lUHkkbF_zOkJn04/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": "gid=0",
          "mode": "list",
          "cachedResultName": "Sheet1",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lc3qFWiDDh_51-_iCbBtzJzDIui4lUHkkbF_zOkJn04/edit#gid=0"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "Invoice Date": "={{ $json['Invoice Date'] }}",
            "Invoice No": "={{ $json.Invoice_number }}",
            "Payment Status": "={{ $json['Payment Method'] }}"
          },
          "matchingColumns": [
            "Invoice No"
          ],
          "schema": [
            {
              "id": "Invoice No",
              "displayName": "Invoice No",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "Invoice Date",
              "displayName": "Invoice Date",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "Due Date",
              "displayName": "Due Date",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "Sender Address",
              "displayName": "Sender Address",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "Sender Phone No",
              "displayName": "Sender Phone No",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "Sender Email",
              "displayName": "Sender Email",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "Sender  Banking details",
              "displayName": "Sender  Banking details",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "Receiver Address",
              "displayName": "Receiver Address",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "Receiver Phone No",
              "displayName": "Receiver Phone No",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "Receiver Email",
              "displayName": "Receiver Email",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "Sub Total",
              "displayName": "Sub Total",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "Tax",
              "displayName": "Tax",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "Total Amount",
              "displayName": "Total Amount",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "Payment Status",
              "displayName": "Payment Status",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "row_number",
              "displayName": "row_number",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "readOnly": true,
              "removed": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.6,
      "position": [
        2240,
        640
      ],
      "id": "2d62f4bb-1ef9-4967-9447-752e9ca8f9b3",
      "name": "Google Sheets5",
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "0QjhWLxNEbbsYTKu",
          "name": "Google Sheets account 3"
        }
      }
    },
    {
      "parameters": {
        "chatId": "=7308047173",
        "text": "Successfully updated the database.",
        "additionalFields": {}
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        2460,
        640
      ],
      "id": "79636d14-4fb6-421a-b7fd-778e02f33b5b",
      "name": "Telegram6",
      "webhookId": "8923f2a2-33f4-4981-875f-e17d07b820ec",
      "credentials": {
        "telegramApi": {
          "id": "RpCZHGbo8GY97ml6",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $('Telegram Trigger').item.json.message.chat.id }}",
        "text": "Payment Status?",
        "additionalFields": {}
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        1240,
        180
      ],
      "id": "d9190f70-1308-479e-bc84-aa2b6aef5b43",
      "name": "Telegram7",
      "webhookId": "4e2bfca3-8965-45c3-92e5-31a456128dc8",
      "credentials": {
        "telegramApi": {
          "id": "RpCZHGbo8GY97ml6",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $('Telegram Trigger').item.json.message.chat.id }}",
        "text": "REMOVING THE INVOICE",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        1280,
        360
      ],
      "id": "cb828c73-9264-4e2a-992a-9d4183a8b641",
      "name": "Telegram10",
      "webhookId": "7e5c9715-7474-4679-a7d2-acb332d7d07c",
      "credentials": {
        "telegramApi": {
          "id": "RpCZHGbo8GY97ml6",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "documentId": {
          "__rl": true,
          "value": "1lc3qFWiDDh_51-_iCbBtzJzDIui4lUHkkbF_zOkJn04",
          "mode": "list",
          "cachedResultName": "invoice",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lc3qFWiDDh_51-_iCbBtzJzDIui4lUHkkbF_zOkJn04/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": "gid=0",
          "mode": "list",
          "cachedResultName": "Sheet1",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lc3qFWiDDh_51-_iCbBtzJzDIui4lUHkkbF_zOkJn04/edit#gid=0"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.6,
      "position": [
        1500,
        380
      ],
      "id": "c8ffe04d-6b6a-4097-a849-ee3eff58927d",
      "name": "Google Sheets2",
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "0QjhWLxNEbbsYTKu",
          "name": "Google Sheets account 3"
        }
      }
    },
    {
      "parameters": {
        "resource": "fileFolder",
        "searchMethod": "query",
        "queryString": "=mimeType != 'application/vnd.google-apps.folder'\n",
        "returnAll": true,
        "filter": {
          "driveId": {
            "mode": "list",
            "value": "My Drive"
          }
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleDrive",
      "typeVersion": 3,
      "position": [
        1940,
        380
      ],
      "id": "b0c27fa1-b312-41f0-bbf7-a81cd3f847d7",
      "name": "Google Drive2",
      "credentials": {
        "googleDriveOAuth2Api": {
          "id": "RHe6oZ7QoI8mqv4g",
          "name": "Google Drive account"
        }
      }
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "3b616706-44d1-45af-9e3b-33c132cc3e78",
              "name": "message.chat.id",
              "value": "={{ $('Telegram Trigger').item.json.message.chat.id }}",
              "type": "string"
            },
            {
              "id": "a0797e26-f8d8-4379-8086-13798aa800a0",
              "name": "message.chat",
              "value": "={{ $json.message.chat }}",
              "type": "object"
            },
            {
              "id": "043ae9a4-f106-4935-b28a-9a0cdc16c4b9",
              "name": "message.sticker.file_id",
              "value": "={{ $json.message.sticker.file_id }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        860,
        0
      ],
      "id": "b8764bf5-267a-48b4-8234-846d919b40bd",
      "name": "Edit Fields2"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "ec051cbf-9d8d-4f8f-8135-413cf6af559a",
              "name": "message.chat.id",
              "value": "={{ $json.message.chat.id }}",
              "type": "number"
            },
            {
              "id": "a65c6b15-c34a-4a16-928e-b30d00cfd4d1",
              "name": "message.chat",
              "value": "={{ $json.message.chat }}",
              "type": "object"
            },
            {
              "id": "38dd63ff-2853-4bee-babd-1760d2c672f5",
              "name": "message.document.file_id",
              "value": "={{ $json.message.document.file_id }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        660,
        -120
      ],
      "id": "6f2b809c-ea2c-42f9-8598-e2420f439426",
      "name": "Edit Fields3"
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "leftValue": "={{ $json.message.text }}",
                    "rightValue": "Yes",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    },
                    "id": "100d7400-c890-413e-8436-7181636ba0b5"
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "edeec13e-3049-49b3-b324-3b99f3be4b02",
                    "leftValue": "={{ $json.message.text }}",
                    "rightValue": "No",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    }
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "4a708071-14e7-4908-b4c7-07e3ebae16bb",
                    "leftValue": "={{ $json.message.text }}",
                    "rightValue": "Paid|Unpaid",
                    "operator": {
                      "type": "string",
                      "operation": "regex"
                    }
                  }
                ],
                "combinator": "and"
              }
            }
          ]
        },
        "options": {
          "fallbackOutput": "extra"
        }
      },
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3.2,
      "position": [
        900,
        260
      ],
      "id": "a1fc3bdf-a401-4fb4-9ef0-fcc3ae2e7318",
      "name": "Switch2",
      "alwaysOutputData": false
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "903d7df1-16d0-4776-88c2-eb6c11c33db2",
              "name": "invoice_number",
              "value": "={{ $('Code2').item.json.invoice_number }}",
              "type": "string"
            },
            {
              "id": "8be326ee-fad5-46e7-8da5-46cffc5058cd",
              "name": "invoice_date",
              "value": "={{ $('Code2').item.json.invoice_date }}",
              "type": "string"
            },
            {
              "id": "5ce4307c-e344-4816-a319-7c2669599a39",
              "name": "due_date",
              "value": "={{ $('Code2').item.json.due_date }}",
              "type": "string"
            },
            {
              "id": "fc14267f-aa20-492d-9e02-4cfb11807479",
              "name": "seller",
              "value": "={{ $('Code2').item.json.seller }}",
              "type": "string"
            },
            {
              "id": "99043c78-8164-4c31-89aa-c4cc4d480d0b",
              "name": "buyer",
              "value": "={{ $('Code2').item.json.buyer }}",
              "type": "string"
            },
            {
              "id": "7e83b9fc-2c76-4708-9b7e-5b13aadc2591",
              "name": "items",
              "value": "={{ $('Code2').item.json.items }}",
              "type": "array"
            },
            {
              "id": "a8c98937-10fe-415f-93cf-c5532340f454",
              "name": "subtotal",
              "value": "={{ $('Code2').item.json.subtotal }}",
              "type": "string"
            },
            {
              "id": "c9e262c8-34f0-4ab4-9fb3-ac4778bb16d2",
              "name": "tax",
              "value": "={{ $('Code2').item.json.tax }}",
              "type": "string"
            },
            {
              "id": "87b30f79-8410-4a7b-b6d5-c0611099e4e1",
              "name": "total_amount",
              "value": "={{ $('Code2').item.json.total_amount }}",
              "type": "string"
            },
            {
              "id": "c12b102f-1986-4615-9948-19cd907825a0",
              "name": "currency",
              "value": "={{ $('Code2').item.json.currency }}",
              "type": "string"
            },
            {
              "id": "9ac3cc6b-9475-46f8-9d09-da2b5624bc06",
              "name": "payment_terms",
              "value": "={{ $('Code2').item.json.payment_terms }}",
              "type": "string"
            },
            {
              "id": "d69a046b-2bc4-4ae4-8e8f-0d201e9dddb1",
              "name": "notes",
              "value": "={{ $('Code2').item.json.notes }}",
              "type": "string"
            },
            {
              "id": "3ed71968-3fee-42ec-9042-7c30f9632313",
              "name": "purchase_order_number",
              "value": "={{ $('Code2').item.json.purchase_order_number }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        3480,
        -420
      ],
      "id": "0e036d44-562c-42fa-a7bc-9d46e8a62f51",
      "name": "Edit Fields4"
    },
    {
      "parameters": {
        "operation": "toJson",
        "options": {}
      },
      "type": "n8n-nodes-base.convertToFile",
      "typeVersion": 1.1,
      "position": [
        3640,
        -420
      ],
      "id": "f936b346-a512-4f90-9f8e-87413c69de9f",
      "name": "Convert to File"
    },
    {
      "parameters": {
        "jsCode": "// Helpers\nconst safeNumber = (val) => {\n  if (val == null || isNaN(val)) return 0;\n  return Number(val);\n};\nconst safeString = (val) => (val == null ? '' : String(val).trim());\n\n// Get and decode binary data\nconst base64Data = items[0].binary?.data?.data;\nif (!base64Data) throw new Error('Binary \"data\" not found');\n\nconst decodedJson = Buffer.from(base64Data, 'base64').toString('utf8');\nconst parsedArray = JSON.parse(decodedJson); // Original is an array of invoice(s)\n\n// We'll transform only the first invoice for now\nconst invoice = parsedArray[0];\n\n// Parse seller and buyer addresses (assuming single-line addresses for now)\nconst [sender_address1, ...sender_address2] = safeString(invoice.seller).split(' ');\nconst [rece_addess1, ...rece_addess2] = safeString(invoice.buyer).split(' ');\n// Transform each item: estimate unit if missing (unit = total / unit_price)\nconst allItems = (invoice.items || []).flat(); // Flatten in case of nested arrays\nconst transformedItems = allItems.map((item) => {\n  const unitPrice = safeNumber(item.unit_price ?? item.unitPrice ?? item.unitprice);\n  const total = safeNumber(item.total ?? item.total_price ?? item.amount);\n  let quantity = safeNumber(item.quantity ?? item.unit);\n  if (!quantity && unitPrice > 0) quantity = total / unitPrice;\n\n  return {\n    item_name: safeString(item.description || item.item_name || item.name),\n    unit: quantity,\n    unit_price: unitPrice,\n    total: total,\n  };\n});\n\n// Final normalized invoice object\nconst transformedInvoice = {\n  date: safeString(invoice.invoice_date),\n  invoice_no: safeString(invoice.invoice_number),\n  sender_address1: sender_address1,\n  sender_address2: sender_address2.join(' '),\n  sender_phone: '', // Not in original data\n  sender_email: '', // Not in original data\n  rece_addess1: rece_addess1,\n  rece_addess2: rece_addess2.join(' '),\n  rece_phone: '', // Not in original data\n  rece_email: '', // Not in original data\n  items: transformedItems,\n  subtotal: safeNumber(invoice.subtotal),\n  tax: safeNumber(invoice.tax),\n  total:(safeNumber(invoice.subtotal)+safeNumber(invoice.tax)).toFixed(2),\n\n\n  footer_email: '', // Can default to sender_email or be empty\n};\n\nreturn [{ json: transformedInvoice }];\n\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        3820,
        -420
      ],
      "id": "e60e3b09-d44f-4044-aec4-ae41ebf6d9f5",
      "name": "Code5"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "903d7df1-16d0-4776-88c2-eb6c11c33db2",
              "name": "invoice_number",
              "value": "={{ $('Code').item.json.invoice_number }}",
              "type": "string"
            },
            {
              "id": "8be326ee-fad5-46e7-8da5-46cffc5058cd",
              "name": "invoice_date",
              "value": "={{ $('Code').item.json.invoice_date }}",
              "type": "string"
            },
            {
              "id": "5ce4307c-e344-4816-a319-7c2669599a39",
              "name": "due_date",
              "value": "={{ $('Code').item.json.due_date }}",
              "type": "string"
            },
            {
              "id": "fc14267f-aa20-492d-9e02-4cfb11807479",
              "name": "seller",
              "value": "={{ $('Code').item.json.seller }}",
              "type": "string"
            },
            {
              "id": "99043c78-8164-4c31-89aa-c4cc4d480d0b",
              "name": "buyer",
              "value": "={{ $('Code').item.json.buyer }}",
              "type": "string"
            },
            {
              "id": "7e83b9fc-2c76-4708-9b7e-5b13aadc2591",
              "name": "items",
              "value": "={{ $('Code').item.json.items }}",
              "type": "array"
            },
            {
              "id": "a8c98937-10fe-415f-93cf-c5532340f454",
              "name": "subtotal",
              "value": "={{ $('Code').item.json.subtotal }}",
              "type": "string"
            },
            {
              "id": "c9e262c8-34f0-4ab4-9fb3-ac4778bb16d2",
              "name": "tax",
              "value": "={{ $('Code').item.json.tax }}",
              "type": "string"
            },
            {
              "id": "87b30f79-8410-4a7b-b6d5-c0611099e4e1",
              "name": "total_amount",
              "value": "={{ $('Code').item.json.total_amount }}",
              "type": "string"
            },
            {
              "id": "c12b102f-1986-4615-9948-19cd907825a0",
              "name": "currency",
              "value": "={{ $('Code').item.json.currency }}",
              "type": "string"
            },
            {
              "id": "9ac3cc6b-9475-46f8-9d09-da2b5624bc06",
              "name": "payment_terms",
              "value": "={{ $('Code').item.json.payment_terms }}",
              "type": "string"
            },
            {
              "id": "d69a046b-2bc4-4ae4-8e8f-0d201e9dddb1",
              "name": "notes",
              "value": "={{ $('Code').item.json.notes }}",
              "type": "string"
            },
            {
              "id": "3ed71968-3fee-42ec-9042-7c30f9632313",
              "name": "purchase_order_number",
              "value": "={{ $('Code').item.json.purchase_order_number }}",
              "type": "string"
            },
            {
              "id": "7d64a112-4904-4848-85eb-8e25a55cc4f4",
              "name": "bank_details",
              "value": "={{ $('Code').item.json.bank_details }}",
              "type": "string"
            },
            {
              "id": "9d7dca42-f44a-443a-a5be-af9e0b6082d7",
              "name": "tax_id",
              "value": "={{ $('Code').item.json.tax_id }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        3440,
        -80
      ],
      "id": "a246b114-7819-4349-a6c1-6e5cdc3508a0",
      "name": "Edit Fields5"
    },
    {
      "parameters": {
        "operation": "toJson",
        "options": {}
      },
      "type": "n8n-nodes-base.convertToFile",
      "typeVersion": 1.1,
      "position": [
        3620,
        -80
      ],
      "id": "94558fdc-7f0d-4b3e-aada-461596e565ce",
      "name": "Convert to File1"
    },
    {
      "parameters": {
        "jsCode": "// Helpers\nconst safeNumber = (val) => {\n  if (val == null || isNaN(val)) return 0;\n  return Number(val);\n};\nconst safeString = (val) => (val == null ? '' : String(val).trim());\n\n// Get and decode binary data\nconst base64Data = items[0].binary?.data?.data;\nif (!base64Data) throw new Error('Binary \"data\" not found');\n\nconst decodedJson = Buffer.from(base64Data, 'base64').toString('utf8');\nconst parsedArray = JSON.parse(decodedJson); // Original is an array of invoice(s)\n\n// We'll transform only the first invoice for now\nconst invoice = parsedArray[0];\n\n// Parse seller and buyer addresses (assuming single-line addresses for now)\nconst [sender_address1, ...sender_address2] = safeString(invoice.seller).split(' ');\nconst [rece_addess1, ...rece_addess2] = safeString(invoice.buyer).split(' ');\n// Transform each item: estimate unit if missing (unit = total / unit_price)\nconst allItems = (invoice.items || []).flat(); // Flatten in case of nested arrays\nconst transformedItems = allItems.map((item) => {\n  const unitPrice = safeNumber(item.unit_price ?? item.unitPrice ?? item.unitprice);\n  const total = safeNumber(item.total ?? item.total_price ?? item.amount);\n  let quantity = safeNumber(item.quantity ?? item.unit);\n  if (!quantity && unitPrice > 0) quantity = total / unitPrice;\n\n  return {\n    item_name: safeString(item.description || item.item_name || item.name),\n    unit: quantity,\n    unit_price: unitPrice,\n    total: total,\n  };\n});\n\n// Final normalized invoice object\nconst transformedInvoice = {\n  date: safeString(invoice.invoice_date),\n  invoice_no: safeString(invoice.invoice_number),\n  sender_address1: sender_address1,\n  sender_address2: sender_address2.join(' '),\n  sender_phone: '', // Not in original data\n  sender_email: '', // Not in original data\n  rece_addess1: rece_addess1,\n  rece_addess2: rece_addess2.join(' '),\n  rece_phone: '', // Not in original data\n  rece_email: '', // Not in original data\n  items: transformedItems,\n  subtotal: safeNumber(invoice.subtotal),\n  tax: safeNumber(invoice.tax),\n  total:(safeNumber(invoice.subtotal)+safeNumber(invoice.tax)).toFixed(2),\n\n\n  footer_email: '', // Can default to sender_email or be empty\n};\n\nreturn [{ json: transformedInvoice }];\n\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        3800,
        -80
      ],
      "id": "a81e33c9-d353-4c90-a258-05d0d151f377",
      "name": "Code6"
    },
    {
      "parameters": {
        "documentId": {
          "__rl": true,
          "value": "1lc3qFWiDDh_51-_iCbBtzJzDIui4lUHkkbF_zOkJn04",
          "mode": "list",
          "cachedResultName": "invoice",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lc3qFWiDDh_51-_iCbBtzJzDIui4lUHkkbF_zOkJn04/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": "gid=0",
          "mode": "list",
          "cachedResultName": "Sheet1",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lc3qFWiDDh_51-_iCbBtzJzDIui4lUHkkbF_zOkJn04/edit#gid=0"
        },
        "filtersUI": {
          "values": [
            {
              "lookupColumn": "Payment Status",
              "lookupValue": "Unpaid"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.6,
      "position": [
        6100,
        -420
      ],
      "id": "ea8fc352-b1f8-4241-b5b9-ac13c06361bf",
      "name": "Google Sheets6",
      "alwaysOutputData": true,
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "0QjhWLxNEbbsYTKu",
          "name": "Google Sheets account 3"
        }
      }
    },
    {
      "parameters": {
        "rule": {
          "interval": [
            {
              "triggerAtHour": 20
            }
          ]
        }
      },
      "type": "n8n-nodes-base.scheduleTrigger",
      "typeVersion": 1.2,
      "position": [
        5880,
        -220
      ],
      "id": "63334210-c007-4afb-992d-015311240831",
      "name": "Schedule Trigger"
    },
    {
      "parameters": {
        "documentId": {
          "__rl": true,
          "value": "1lc3qFWiDDh_51-_iCbBtzJzDIui4lUHkkbF_zOkJn04",
          "mode": "list",
          "cachedResultName": "invoice",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lc3qFWiDDh_51-_iCbBtzJzDIui4lUHkkbF_zOkJn04/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": "gid=0",
          "mode": "list",
          "cachedResultName": "Sheet1",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lc3qFWiDDh_51-_iCbBtzJzDIui4lUHkkbF_zOkJn04/edit#gid=0"
        },
        "filtersUI": {
          "values": [
            {
              "lookupColumn": "Payment Status",
              "lookupValue": "Unpaid"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.6,
      "position": [
        5620,
        -80
      ],
      "id": "d969bc18-0c35-4ace-9e24-e4cd698acd47",
      "name": "Google Sheets7",
      "alwaysOutputData": true,
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "0QjhWLxNEbbsYTKu",
          "name": "Google Sheets account 3"
        }
      }
    },
    {
      "parameters": {
        "rule": {
          "interval": [
            {
              "triggerAtHour": 20
            }
          ]
        }
      },
      "type": "n8n-nodes-base.scheduleTrigger",
      "typeVersion": 1.2,
      "position": [
        5460,
        160
      ],
      "id": "4252042b-8781-4512-ac2a-4416372afa42",
      "name": "Schedule Trigger1"
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "={{ $('Telegram Trigger').item.json.message.text }}",
        "options": {
          "systemMessage": "Hi there! 👋 I’ll help you generate a professional invoice.\nIF ALL DETAILS ARE GIVEN IN ONE MESSAGE GENEREATE SUMMARY IN THE NEXT MESSAGE!\n\nI’ll ask for each detail one at a time. I’ll calculate all totals automatically for you.\n\nLet’s begin:\n\n1. What’s your **Invoice Number**?\n\n2. What is the **Invoice Date**? (DD/MM/YYYY)\n\n3. What is the **Due Date**?\n\n4. Please provide your **Business Address** (Sender Address).\n\n5. What is your **Business Email**?\n\n6. What is your **Business Phone Number**?\n\n7. What is your **Bank Account Number**?\n\n8. What is your **Bank Name**?\n\n9. What is your **Routing Number**? (Type \"no\" if you don’t have one)\n\n10. Please enter the **Receiver’s Address**.\n\n11. What is the **Receiver’s Email**?\n\n12. What is the **Receiver’s Phone Number**?\n\n13. How many **items** are in this invoice?\n\nGreat! Let’s enter item details one by one.\n\nFor each item, reply in this format:  \n`Item Name, Quantity, Unit Price`\n\nExample:  \n`Laptop, 2, 45000`\n\n(Your bot will automatically calculate the total per item.)\n\nOnce all items are added, I’ll calculate the totals for you.\n\n14. What is the **tax rate** you want to apply? (e.g., 18 for 18%)\n\n(Your bot will now calculate subtotal, tax amount, and grand total.)\n\n15. Any **terms and conditions** you'd like to include? (Type \"no\" to skip.)\n\n----------------------------------------\nHere’s your invoice summary:\n\nINVOICE SUMMARY\n\nInvoice No: [Invoice Number]  \nInvoice Date: [Date]  \nDue Date: [Due Date]\n\nFrom:  \n[Sender Address]  \nEmail: [Sender Email]  \nPhone: [Sender Phone]  \nBank Account: [Bank Account]  \nBank Name: [Bank Name]  \nRouting Number: [Routing Number or \"N/A\"]\n\nTo:  \n[Receiver Address]  \nEmail: [Receiver Email]  \nPhone: [Receiver Phone]\n\nItems:\n- [Item 1 Name], Qty: [Qty], Unit Price: ₹[Price], Total: ₹[Qty * Price]\n- [Item 2 Name], Qty: [Qty], Unit Price: ₹[Price], Total: ₹[Qty * Price]\n... (list all)\n\nSubtotal: ₹[Calculated Sum of All Items]  \nTax ([Tax Rate]%): ₹[Calculated Tax]  \nGrand Total: ₹[Subtotal + Tax]\n\nTerms: [If provided]\n\n----------------------------------------\n\nLet me know if everything looks good or if you’d like to make changes.\nMake sure the restrictions for the fields are maintained ...have contraints on the numbers , email and so on.\n\nIMPORTANT:Lastly if all details are given in one go provide the summary for the invoice.\n\n\n\n"
        }
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 1.9,
      "position": [
        920,
        880
      ],
      "id": "673bb3dc-7ab0-42e8-881c-c9c305665474",
      "name": "AI Agent"
    },
    {
      "parameters": {
        "modelName": "models/gemini-1.5-flash-latest",
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatGoogleGemini",
      "typeVersion": 1,
      "position": [
        900,
        1060
      ],
      "id": "2ea21543-35bc-42f3-b3ff-fddcac4092f5",
      "name": "Google Gemini Chat Model1",
      "credentials": {
        "googlePalmApi": {
          "id": "oX6GN6LX2hphLuiB",
          "name": "Google Gemini(PaLM) Api account"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $('Telegram Trigger').item.json.message.chat.id }}",
        "text": "={{ $json.output }}",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        1280,
        880
      ],
      "id": "20607d68-6ae6-4b38-87d6-1bb6f5ea23ba",
      "name": "Telegram3",
      "webhookId": "67ec8c4e-059a-45ed-b54b-ad4c6f399e94",
      "credentials": {
        "telegramApi": {
          "id": "RpCZHGbo8GY97ml6",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "={{ $json.text }}",
        "messages": {
          "messageValues": [
            {
              "message": "You are an invoice data extractor.  Wait silently until you receive a message that contains all required fields to construct a full invoice. Only when all required information is present, extract and return it as clean structured JSON.  The input will be a plain text message, potentially from a human on Telegram.  Required fields (all must be present before extracting): - Invoice Number - Invoice Date - Due Date - Seller Complete Address - Seller Email Address - Seller Phone Number - Seller Bank Account Number - Seller Bank Name - Seller Routing Number (or IFSC/SWIFT) - Receiver Complete Address - Receiver Email Address - Receiver Phone Number - Number of items - For each item:   - Description   - Quantity   - Unit Price   - Total Amount - Subtotal - Tax Rate - Tax Amount - Final Total Amount - Terms and Conditions (optional)  Return the output in **this exact JSON structure** when everything is available:  ```json {   \"invoice_number\": \"\",   \"invoice_date\": \"\",   \"due_date\": \"\",   \"seller\": {     \"address\": \"\",     \"email\": \"\",     \"phone\": \"\",     \"bank_account_number\": \"\",     \"bank_name\": \"\",     \"routing_number\": \"\"   },   \"receiver\": {     \"address\": \"\",     \"email\": \"\",     \"phone\": \"\"   },   \"items\": [     {       \"description\": \"\",       \"quantity\": 0,       \"unit_price\": 0,       \"total_amount\": 0     }   ],   \"subtotal\": 0,   \"tax_rate\": 0,   \"tax_amount\": 0,   \"final_total_amount\": 0,   \"terms_and_conditions\": \"\" }"
            }
          ]
        }
      },
      "type": "@n8n/n8n-nodes-langchain.chainLlm",
      "typeVersion": 1.6,
      "position": [
        1880,
        920
      ],
      "id": "e43f27cc-902d-4e8f-a591-454cc53c1731",
      "name": "Basic LLM Chain1"
    },
    {
      "parameters": {
        "modelName": "models/gemini-1.5-flash-8b",
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatGoogleGemini",
      "typeVersion": 1,
      "position": [
        1940,
        1060
      ],
      "id": "ebaeb376-0666-4030-9725-20bf46c63c9f",
      "name": "Google Gemini Chat Model3",
      "credentials": {
        "googlePalmApi": {
          "id": "oX6GN6LX2hphLuiB",
          "name": "Google Gemini(PaLM) Api account"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "// Input: an array with one object containing 'text' property which includes a JSON block in triple backticks\n\n// Step 1: Extract the raw text from the first input item\nconst rawText = $input.first().json.text;\n\n// Step 2: Extract the JSON block inside the triple backticks ```json ... ```\nconst jsonMatch = rawText.match(/```json\\s*([\\s\\S]*?)```/i);\n\nif (!jsonMatch) {\n  throw new Error(\"JSON block not found in input text\");\n}\n\n// Step 3: Parse the JSON string inside the backticks\nconst invoiceData = JSON.parse(jsonMatch[1]);\n\n// Step 4: Return the parsed JSON as output\nreturn [{ json: invoiceData }];\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        2320,
        980
      ],
      "id": "650c511b-aed6-46d2-9844-cdbac4f239d0",
      "name": "Code1"
    },
    {
      "parameters": {
        "operation": "append",
        "documentId": {
          "__rl": true,
          "value": "1lc3qFWiDDh_51-_iCbBtzJzDIui4lUHkkbF_zOkJn04",
          "mode": "list",
          "cachedResultName": "invoice",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lc3qFWiDDh_51-_iCbBtzJzDIui4lUHkkbF_zOkJn04/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": "gid=0",
          "mode": "list",
          "cachedResultName": "Sheet1",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lc3qFWiDDh_51-_iCbBtzJzDIui4lUHkkbF_zOkJn04/edit#gid=0"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "Invoice No": "={{ $json.invoice_number }}",
            "Invoice Date": "={{ $json.invoice_date }}",
            "Due Date": "={{ $json.due_date }}",
            "Sender Address": "={{ $json.seller.address }}",
            "Sender Email": "={{ $json.seller.email }}",
            "Sender Phone No": "={{ $json.seller.phone }}",
            "Sender  Banking details": "={{ $json.seller.bank_name }}\n{{ $json.seller.bank_account_number }}\n",
            "Receiver Address": "={{ $json.receiver.address }}",
            "Receiver Phone No": "={{ $json.receiver.email }}",
            "Receiver Email": "={{ $json.receiver.phone }}",
            "Sub Total": "={{ $json.subtotal }}",
            "Tax": "={{ $json.tax_amount }}",
            "Total Amount": "={{ $json.final_total_amount }}",
            "Items": "={{ $json.items }}"
          },
          "matchingColumns": [],
          "schema": [
            {
              "id": "Invoice No",
              "displayName": "Invoice No",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "Invoice Date",
              "displayName": "Invoice Date",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "Due Date",
              "displayName": "Due Date",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "Sender Address",
              "displayName": "Sender Address",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "Sender Phone No",
              "displayName": "Sender Phone No",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "Sender Email",
              "displayName": "Sender Email",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "Sender  Banking details",
              "displayName": "Sender  Banking details",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "Receiver Address",
              "displayName": "Receiver Address",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "Receiver Phone No",
              "displayName": "Receiver Phone No",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "Receiver Email",
              "displayName": "Receiver Email",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "Items",
              "displayName": "Items",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "Sub Total",
              "displayName": "Sub Total",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "Tax",
              "displayName": "Tax",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "Total Amount",
              "displayName": "Total Amount",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "Payment Status",
              "displayName": "Payment Status",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.6,
      "position": [
        2500,
        980
      ],
      "id": "0d14db42-cd1c-4837-b741-9d77ca735eae",
      "name": "Google Sheets8",
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "0QjhWLxNEbbsYTKu",
          "name": "Google Sheets account 3"
        }
      }
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "b1874647-8e1c-458f-b9e3-0c6eeeb143b2",
              "name": "invoice_no",
              "value": "={{ $json['Invoice No'] }}",
              "type": "string"
            },
            {
              "id": "9257b427-0dfc-4d53-a5d4-13e8d9ec7345",
              "name": "date",
              "value": "={{ $json['Invoice Date'] }}",
              "type": "string"
            },
            {
              "id": "41fa45e3-6447-4ec0-aa62-1aefe8e146a6",
              "name": "duedate",
              "value": "={{ $json['Due Date'] }}",
              "type": "string"
            },
            {
              "id": "bffe988d-eb23-4425-917a-a226296808df",
              "name": "sender_address1",
              "value": "={{ $json['Sender Address'] }}",
              "type": "string"
            },
            {
              "id": "5dc85229-31f0-4229-9b86-7a2d38397a14",
              "name": "sender_email",
              "value": "={{ $json['Sender Email'] }}",
              "type": "string"
            },
            {
              "id": "003abfdb-b7ab-43a9-877e-1f4063752c31",
              "name": "sender_phone",
              "value": "={{ $json['Sender Phone No'] }}",
              "type": "string"
            },
            {
              "id": "2d271723-3c5a-4422-8a3e-54af9fd9311d",
              "name": "rece_addess1",
              "value": "={{ $json['Receiver Address'] }}",
              "type": "string"
            },
            {
              "id": "2dcd2f24-ebe2-4c7f-8196-18f0463ac044",
              "name": "rece_phone",
              "value": "=",
              "type": "string"
            },
            {
              "id": "31084748-ef2e-425d-9976-632299bbbf47",
              "name": "rece_email",
              "value": "={{ $json['Receiver Email'] }}",
              "type": "string"
            },
            {
              "id": "abd436e5-124c-4163-85fe-d670c3abe55c",
              "name": "items",
              "value": "={{ $('Code1').item.json.items }}",
              "type": "array"
            },
            {
              "id": "6d3d613a-8dee-4b1c-9e3c-2d401049dea1",
              "name": "subtotal",
              "value": "={{ $('Code1').item.json.subtotal }}",
              "type": "number"
            },
            {
              "id": "fe889203-2816-4ba1-a09b-893e5bc0cccb",
              "name": "tax",
              "value": "={{ $('Code1').item.json.tax_amount }}",
              "type": "number"
            },
            {
              "id": "c2deeb88-73e7-48df-8ccf-8561f51400bc",
              "name": "total",
              "value": "={{ $('Code1').item.json.final_total_amount }}",
              "type": "number"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        2720,
        980
      ],
      "id": "293ca430-a36e-4b76-93ce-ef530288799e",
      "name": "Edit Fields6"
    },
    {
      "parameters": {
        "jsCode": "// Helpers\nconst safeNumber = (val) => {\n  if (val == null || isNaN(val)) return 0;\n  return Number(val);\n};\nconst safeString = (val) => (val == null ? '' : String(val).trim());\n\n// Get and decode binary data\nconst base64Data = items[0].binary?.data?.data;\nif (!base64Data) throw new Error('Binary \"data\" not found');\n\nconst decodedJson = Buffer.from(base64Data, 'base64').toString('utf8');\nconst parsedArray = JSON.parse(decodedJson); // Array of invoices\n\n// Use first invoice only\nconst invoice = parsedArray[0];\n\n// Normalize items array\nconst allItems = (invoice.items || []).flat();\nconst transformedItems = allItems.map((item) => {\n  const unitPrice = safeNumber(item.unit_price ?? item.unitPrice ?? item.unitprice);\n  const total = safeNumber(item.total_amount ?? item.total_price ?? item.amount ?? item.total);\n  let quantity = safeNumber(item.quantity ?? item.unit);\n  if (!quantity && unitPrice > 0) quantity = total / unitPrice;\n\n  return {\n    item_name: safeString(item.description || item.item_name || item.name),\n    unit: quantity,\n    unit_price: unitPrice,\n    total: total,\n  };\n});\n\n// Final normalized invoice object\nconst transformedInvoice = {\n  invoice_no: safeString(invoice.invoice_number ?? invoice.invoice_no),\n  date: safeString(invoice.invoice_date ?? invoice.date),\n  duedate: safeString(invoice.due_date ?? invoice.duedate),\n  sender_address1: safeString(invoice.sender_address1 ?? invoice.seller),\n  sender_email: safeString(invoice.sender_email ?? ''),\n  sender_phone: safeString(invoice.sender_phone ?? ''),\n  rece_addess1: safeString(invoice.rece_addess1 ?? invoice.buyer),\n  rece_email: safeString(invoice.rece_email ?? ''),\n  rece_phone: safeString(invoice.rece_phone ?? ''),\n  items: transformedItems,\n  subtotal: safeNumber(invoice.subtotal),\n  tax: safeNumber(invoice.tax),\n  total: (safeNumber(invoice.subtotal) + safeNumber(invoice.tax)).toFixed(2),\n};\n\nreturn [{ json: transformedInvoice }];\n\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        3140,
        980
      ],
      "id": "80d8c596-2849-4d61-8d29-178e5a5211a4",
      "name": "Code4"
    },
    {
      "parameters": {
        "documentId": {
          "__rl": true,
          "value": "1lc3qFWiDDh_51-_iCbBtzJzDIui4lUHkkbF_zOkJn04",
          "mode": "list",
          "cachedResultName": "invoice",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lc3qFWiDDh_51-_iCbBtzJzDIui4lUHkkbF_zOkJn04/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": "gid=0",
          "mode": "list",
          "cachedResultName": "Sheet1",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lc3qFWiDDh_51-_iCbBtzJzDIui4lUHkkbF_zOkJn04/edit#gid=0"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.6,
      "position": [
        5680,
        980
      ],
      "id": "e60471dc-2536-4656-a95d-8a593ace6be9",
      "name": "Google Sheets9",
      "alwaysOutputData": true,
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "0QjhWLxNEbbsYTKu",
          "name": "Google Sheets account 3"
        }
      }
    },
    {
      "parameters": {
        "rule": {
          "interval": [
            {
              "triggerAtHour": 20
            }
          ]
        }
      },
      "type": "n8n-nodes-base.scheduleTrigger",
      "typeVersion": 1.2,
      "position": [
        5540,
        760
      ],
      "id": "953dd81a-04ca-443e-8b08-5ccd1f8bcae0",
      "name": "Schedule Trigger2"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "e1c6550e-c2d1-4628-bac2-8775ffc2cc11",
              "leftValue": "={{ $json.status }}",
              "rightValue": "ready_to_extract",
              "operator": {
                "type": "string",
                "operation": "equals",
                "name": "filter.operator.equals"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        1640,
        920
      ],
      "id": "47383312-d128-46e5-afc2-7c211779b61f",
      "name": "If"
    },
    {
      "parameters": {},
      "type": "n8n-nodes-base.noOp",
      "typeVersion": 1,
      "position": [
        1780,
        1220
      ],
      "id": "b5b8be5a-101b-4b99-afcf-218aa877cf77",
      "name": "No Operation, do nothing"
    },
    {
      "parameters": {
        "jsCode": "// Extract the text string from nested input\nlet text = \"\";\n\n// Your input looks like an array with one element, which has 'result' and then 'text'\nif (Array.isArray($input.all())) {\n  const inputArray = $input.all();\n  if (inputArray.length > 0 && inputArray[0].json && inputArray[0].json.result && typeof inputArray[0].json.result.text === \"string\") {\n    text = inputArray[0].json.result.text;\n  }\n}\n\n// Define keywords/patterns to check presence of invoice details\nconst checks = {\n  invoiceNumber: /invoice\\s*(no|number)?[:\\s]/i,\n  invoiceDate: /\\bdate\\b[:\\s]/i,\n  dueDate: /\\bdue\\b[:\\s]/i,\n  sellerInfo: /(seller|plot no\\.|billing@technova\\.in|address|phone)/i,\n  receiverInfo: /(receiver|bill to|accounts@bluehorizon\\.co\\.in|address|phone)/i,\n  itemsTable: /(description\\s*\\|\\s*quantity\\s*\\|\\s*unit price\\s*\\|\\s*total)/i,\n  subtotal: /subtotal[:\\s]/i,\n  tax: /tax\\s*\\(\\d+%\\)?:/i,\n  total: /total[:\\s]/i,\n  paymentTerms: /(payment terms|terms and conditions|payment due)/i,\n  bankDetails: /(bank|account number|routing number)/i\n};\n\n// Count how many checks passed\nconst foundCount = Object.values(checks).reduce((acc, regex) => acc + (regex.test(text) ? 1 : 0), 0);\n\n// Define minimum required to consider message complete\nconst minRequired = 8;\n\nif (foundCount >= minRequired) {\n  return [{ json: { status: \"ready_to_extract\", foundCount, text } }];\n} else {\n  return [{ json: { status: \"waiting_for_more_info\", foundCount, text } }];\n}\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        1420,
        880
      ],
      "id": "f0e3e0e7-799b-4233-bc47-eb2f82bc60a8",
      "name": "Code3"
    },
    {
      "parameters": {
        "sessionIdType": "customKey",
        "sessionKey": "7308047173",
        "contextWindowLength": 2000000
      },
      "type": "@n8n/n8n-nodes-langchain.memoryBufferWindow",
      "typeVersion": 1.3,
      "position": [
        1020,
        1080
      ],
      "id": "f0307a30-8876-456b-a526-6535d3eace00",
      "name": "Simple Memory"
    },
    {
      "parameters": {
        "url": "https://docs.googleapis.com/v1/documents/1QjHIfBo8LjbI-jJZroFwqK8A7ecPhlLCQRWmIz2A2bI",
        "authentication": "predefinedCredentialType",
        "nodeCredentialType": "googleDocsOAuth2Api",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {}
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        3360,
        980
      ],
      "id": "a8358e64-b710-4f48-8949-a7d514ad2515",
      "name": "HTTP Request",
      "credentials": {
        "googleDocsOAuth2Api": {
          "id": "5U2uokXrTrdFYjWn",
          "name": "Google Docs account"
        }
      }
    },
    {
      "parameters": {
        "operation": "toJson",
        "options": {}
      },
      "type": "n8n-nodes-base.convertToFile",
      "typeVersion": 1.1,
      "position": [
        2940,
        980
      ],
      "id": "5892e3fb-df90-47aa-a4bc-f1f229fc860f",
      "name": "Convert to File2"
    },
    {
      "parameters": {
        "url": "https://docs.googleapis.com/v1/documents/1QjHIfBo8LjbI-jJZroFwqK8A7ecPhlLCQRWmIz2A2bI",
        "authentication": "predefinedCredentialType",
        "nodeCredentialType": "googleDocsOAuth2Api",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {}
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        3980,
        -80
      ],
      "id": "395f46c0-a6f3-401f-8ebe-13ea65e8d974",
      "name": "HTTP Request2",
      "credentials": {
        "googleDocsOAuth2Api": {
          "id": "5U2uokXrTrdFYjWn",
          "name": "Google Docs account"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "// 🔹 Function to extract placeholders from Google Docs body.content\nfunction extractPlaceholdersFromContent(contentArray) {\n  const placeholders = new Set();\n\n  function extractFromText(text) {\n    const matches = [...text.matchAll(/{{(.*?)}}/g)];\n    matches.forEach(m => placeholders.add(m[1]));\n  }\n\n  function extractFromParagraph(paragraph) {\n    for (const el of paragraph.elements || []) {\n      if (el.textRun?.content) {\n        extractFromText(el.textRun.content);\n      }\n    }\n  }\n\n  function extractFromTable(table) {\n    for (const row of table.tableRows || []) {\n      for (const cell of row.tableCells || []) {\n        for (const block of cell.content || []) {\n          if (block.paragraph) {\n            extractFromParagraph(block.paragraph);\n          }\n        }\n      }\n    }\n  }\n\n  for (const block of contentArray || []) {\n    if (block.paragraph) {\n      extractFromParagraph(block.paragraph);\n    } else if (block.table) {\n      extractFromTable(block.table);\n    }\n  }\n\n  return Array.from(placeholders);\n}\n\n// 🔹 Function to map invoice data to known placeholder structure\nfunction mapInvoiceToPlaceholders($json) {\n  const invoice = $json\n\n  const mappedData = {\n    sender_address: invoice.sender_address1 || '',\n    sender_phone: invoice.sender_phone || '',\n    sender_email: invoice.sender_email || '',\n\n    rece_address: invoice.rece_addess1 || '',\n    rece_phone: invoice.rece_phone || '',\n    rece_email: invoice.rece_email || '',\n\n    invoice_no: invoice.invoice_no || '',\n    date: invoice.date || '',\n    duedate: invoice.duedate || '',\n\n    subtotal: invoice.subtotal ?? 0,\n    tax: invoice.tax ?? 0,\n    total: invoice.total ?? 0,\n    notes: invoice.notes || ''\n  };\n\n  const maxItems = 7;\n  const items = invoice.items || [];\n\n  for (let i = 0; i < maxItems; i++) {\n    const itemIndex = i + 1;\n    const item = items[i] || {};\n\n    mappedData[`item_${itemIndex}_name`] = item.item_name || '';\n    mappedData[`item_${itemIndex}_qty`] = item.unit ?? 0;\n    mappedData[`item_${itemIndex}_unit_price`] = item.unit_price ?? 0;\n    mappedData[`item_${itemIndex}_total`] = item.total ?? 0;\n  }\n\n  return mappedData;\n}\n\n// 🔹 Main logic for n8n — process each input item\nreturn $input.all().map(item => {\n  const data = item.json;\n\n  // If Google Docs content exists, extract placeholders\n  if (data.body?.content) {\n    data.placeholders = extractPlaceholdersFromContent(data.body.content);\n  }\n\n  const mapped = mapInvoiceToPlaceholders(data);\n\n  return { json: mapped };\n});\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        4460,
        -80
      ],
      "id": "2373d4e4-3f0e-4696-a634-02e580d871c2",
      "name": "Code10"
    },
    {
      "parameters": {
        "jsCode": "// Get all items (array) from \"Code4\"\nconst data = $items(\"Code4\", 0);\n\n// Simply return them as-is\nreturn data;\n\n\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        4320,
        -80
      ],
      "id": "85745d8b-74f7-46a8-b0c4-56299ae63b7c",
      "name": "Code11"
    },
    {
      "parameters": {
        "method": "POST",
        "url": "=https://docs.googleapis.com/v1/documents/{{ $('Google Drive13').item.json.id }}:batchUpdate\n\n",
        "authentication": "predefinedCredentialType",
        "nodeCredentialType": "googleDocsOAuth2Api",
        "sendBody": true,
        "bodyParameters": {
          "parameters": [
            {
              "name": "requests",
              "value": "={{$json.requests}}"
            }
          ]
        },
        "options": {
          "batching": {
            "batch": {
              "batchSize": 50,
              "batchInterval": 1000
            }
          },
          "response": {}
        }
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        4840,
        -80
      ],
      "id": "2d17fbc3-41a6-4cf2-8b3a-d6b00262434e",
      "name": "HTTP Request3",
      "credentials": {
        "googleDocsOAuth2Api": {
          "id": "5U2uokXrTrdFYjWn",
          "name": "Google Docs account"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "const values = $json;\nconst requests = [];\n\nfor (const [key, value] of Object.entries(values)) {\n  requests.push({\n    replaceAllText: {\n      containsText: {\n        text: `{{${key}}}`,\n        matchCase: true\n      },\n      replaceText: value.toString()\n    }\n  });\n}\n\nreturn [{ json: { requests } }];\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        4620,
        -80
      ],
      "id": "109dc849-e1d1-4b4e-a51b-b000c022381d",
      "name": "Code12"
    },
    {
      "parameters": {
        "operation": "download",
        "fileId": {
          "__rl": true,
          "value": "={{ $('Google Drive13').item.json.id }}",
          "mode": "id"
        },
        "options": {
          "googleFileConversion": {
            "conversion": {
              "docsToFormat": "application/pdf"
            }
          },
          "fileName": "pdf"
        }
      },
      "type": "n8n-nodes-base.googleDrive",
      "typeVersion": 3,
      "position": [
        5040,
        -80
      ],
      "id": "68e65ee8-13e3-488d-94f7-2fd6703115bc",
      "name": "Google Drive7",
      "credentials": {
        "googleDriveOAuth2Api": {
          "id": "RHe6oZ7QoI8mqv4g",
          "name": "Google Drive account"
        }
      }
    },
    {
      "parameters": {
        "driveId": {
          "__rl": true,
          "mode": "list",
          "value": "My Drive"
        },
        "folderId": {
          "__rl": true,
          "mode": "list",
          "value": "root",
          "cachedResultName": "/ (Root folder)"
        },
        "options": {
          "simplifyOutput": true
        }
      },
      "type": "n8n-nodes-base.googleDrive",
      "typeVersion": 3,
      "position": [
        5180,
        -80
      ],
      "id": "7b351eee-c4bc-4dfa-a31c-248c43b59b5c",
      "name": "Google Drive8",
      "credentials": {
        "googleDriveOAuth2Api": {
          "id": "RHe6oZ7QoI8mqv4g",
          "name": "Google Drive account"
        }
      }
    },
    {
      "parameters": {
        "operation": "download",
        "fileId": {
          "__rl": true,
          "value": "1QjHIfBo8LjbI-jJZroFwqK8A7ecPhlLCQRWmIz2A2bI",
          "mode": "list",
          "cachedResultName": "template",
          "cachedResultUrl": "https://docs.google.com/document/d/1QjHIfBo8LjbI-jJZroFwqK8A7ecPhlLCQRWmIz2A2bI/edit?usp=drivesdk"
        },
        "options": {
          "googleFileConversion": {
            "conversion": {
              "docsToFormat": "application/pdf"
            }
          },
          "fileName": "pdf"
        }
      },
      "type": "n8n-nodes-base.googleDrive",
      "typeVersion": 3,
      "position": [
        5380,
        -80
      ],
      "id": "6ab563d0-b5f1-43fd-acee-8a72a0c301f5",
      "name": "Google Drive9",
      "credentials": {
        "googleDriveOAuth2Api": {
          "id": "RHe6oZ7QoI8mqv4g",
          "name": "Google Drive account"
        }
      }
    },
    {
      "parameters": {
        "url": "https://docs.googleapis.com/v1/documents/1QjHIfBo8LjbI-jJZroFwqK8A7ecPhlLCQRWmIz2A2bI",
        "authentication": "predefinedCredentialType",
        "nodeCredentialType": "googleDocsOAuth2Api",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {}
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        4020,
        -420
      ],
      "id": "32ac03ff-eaf7-45a9-accd-d40b56e2a1ab",
      "name": "HTTP Request4",
      "credentials": {
        "googleDocsOAuth2Api": {
          "id": "5U2uokXrTrdFYjWn",
          "name": "Google Docs account"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "// Your function to extract placeholders (unchanged)\nfunction extractPlaceholdersFromContent(contentArray) {\n  const placeholders = new Set();\n\n  function extractFromText(text) {\n    const matches = [...text.matchAll(/{{(.*?)}}/g)];\n    matches.forEach(m => placeholders.add(m[1]));\n  }\n\n  function extractFromParagraph(paragraph) {\n    for (const el of paragraph.elements || []) {\n      if (el.textRun?.content) {\n        extractFromText(el.textRun.content);\n      }\n    }\n  }\n\n  function extractFromTable(table) {\n    for (const row of table.tableRows || []) {\n      for (const cell of row.tableCells || []) {\n        for (const block of cell.content || []) {\n          if (block.paragraph) {\n            extractFromParagraph(block.paragraph);\n          }\n        }\n      }\n    }\n  }\n\n  for (const block of contentArray || []) {\n    if (block.paragraph) {\n      extractFromParagraph(block.paragraph);\n    } else if (block.table) {\n      extractFromTable(block.table);\n    }\n  }\n\n  return Array.from(placeholders);\n}\n\n// Main n8n code execution\n\n\n\n// 🔹 Function to map invoice data to known placeholder structure\nfunction mapInvoiceToPlaceholders($json) {\n  const invoice = $json\n\n  const mappedData = {\n    sender_address: invoice.sender_address1 || '',\n    sender_phone: invoice.sender_phone || '',\n    sender_email: invoice.sender_email || '',\n\n    rece_address: invoice.rece_addess1 || '',\n    rece_phone: invoice.rece_phone || '',\n    rece_email: invoice.rece_email || '',\n\n    invoice_no: invoice.invoice_no || '',\n    date: invoice.date || '',\n    duedate: invoice.duedate || '',\n\n    subtotal: invoice.subtotal ?? 0,\n    tax: invoice.tax ?? 0,\n    total: invoice.total ?? 0,\n    notes: invoice.notes || ''\n  };\n\n  const maxItems = 7;\n  const items = invoice.items || [];\n\n  for (let i = 0; i < maxItems; i++) {\n    const itemIndex = i + 1;\n    const item = items[i] || {};\n\n    mappedData[`item_${itemIndex}_name`] = item.item_name || '';\n    mappedData[`item_${itemIndex}_qty`] = item.unit ?? 0;\n    mappedData[`item_${itemIndex}_unit_price`] = item.unit_price ?? 0;\n    mappedData[`item_${itemIndex}_total`] = item.total ?? 0;\n  }\n\n  return mappedData;\n}\n\n// 🔹 Main logic for n8n — process each input item\nreturn $input.all().map(item => {\n  const data = item.json;\n\n  // If Google Docs content exists, extract placeholders\n  if (data.body?.content) {\n    data.placeholders = extractPlaceholdersFromContent(data.body.content);\n  }\n\n  const mapped = mapInvoiceToPlaceholders(data);\n\n  return { json: mapped };\n});\n\n\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        4660,
        -420
      ],
      "id": "f075f122-4798-430d-a76c-d8bc55089892",
      "name": "Code13"
    },
    {
      "parameters": {
        "jsCode": "// Get all items (array) from \"Code4\"\nconst data = $items(\"Code5\", 0);\n\n// Simply return them as-is\nreturn data;\n\n\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        4440,
        -420
      ],
      "id": "a722baf8-f95d-41bd-8909-eaf690878903",
      "name": "Code14"
    },
    {
      "parameters": {
        "method": "POST",
        "url": "=https://docs.googleapis.com/v1/documents/{{ $('Google Drive1').item.json.id }}:batchUpdate\n\n",
        "authentication": "predefinedCredentialType",
        "nodeCredentialType": "googleDocsOAuth2Api",
        "sendBody": true,
        "bodyParameters": {
          "parameters": [
            {
              "name": "requests",
              "value": "={{$json.requests}}"
            }
          ]
        },
        "options": {
          "batching": {
            "batch": {
              "batchSize": 50,
              "batchInterval": 1000
            }
          },
          "response": {}
        }
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        5060,
        -420
      ],
      "id": "dfe50217-8706-4493-aefd-acbb62fed203",
      "name": "HTTP Request5",
      "credentials": {
        "googleDocsOAuth2Api": {
          "id": "5U2uokXrTrdFYjWn",
          "name": "Google Docs account"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "const values = $json;\nconst requests = [];\n\nfor (const [key, value] of Object.entries(values)) {\n  requests.push({\n    replaceAllText: {\n      containsText: {\n        text: `{{${key}}}`,\n        matchCase: true\n      },\n      replaceText: value.toString()\n    }\n  });\n}\n\nreturn [{ json: { requests } }];\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        4840,
        -420
      ],
      "id": "9b093374-53b7-43a6-9ea6-bfd9918f5e24",
      "name": "Code15"
    },
    {
      "parameters": {
        "operation": "download",
        "fileId": {
          "__rl": true,
          "value": "={{ $('Google Drive1').item.json.id }}",
          "mode": "id"
        },
        "options": {
          "googleFileConversion": {
            "conversion": {
              "docsToFormat": "application/pdf"
            }
          },
          "fileName": "pdf"
        }
      },
      "type": "n8n-nodes-base.googleDrive",
      "typeVersion": 3,
      "position": [
        5260,
        -420
      ],
      "id": "197da69e-8a92-4c5a-8306-9d43c083e11c",
      "name": "Google Drive",
      "credentials": {
        "googleDriveOAuth2Api": {
          "id": "RHe6oZ7QoI8mqv4g",
          "name": "Google Drive account"
        }
      }
    },
    {
      "parameters": {
        "driveId": {
          "__rl": true,
          "mode": "list",
          "value": "My Drive"
        },
        "folderId": {
          "__rl": true,
          "mode": "list",
          "value": "root",
          "cachedResultName": "/ (Root folder)"
        },
        "options": {
          "simplifyOutput": true
        }
      },
      "type": "n8n-nodes-base.googleDrive",
      "typeVersion": 3,
      "position": [
        5400,
        -420
      ],
      "id": "fc3bd124-ee69-4e07-af42-a49a0a47e16f",
      "name": "Google Drive10",
      "credentials": {
        "googleDriveOAuth2Api": {
          "id": "RHe6oZ7QoI8mqv4g",
          "name": "Google Drive account"
        }
      }
    },
    {
      "parameters": {
        "operation": "download",
        "fileId": {
          "__rl": true,
          "value": "={{ $json.id }}",
          "mode": "id"
        },
        "options": {
          "googleFileConversion": {
            "conversion": {
              "docsToFormat": "application/pdf"
            }
          },
          "fileName": "pdf"
        }
      },
      "type": "n8n-nodes-base.googleDrive",
      "typeVersion": 3,
      "position": [
        5600,
        -420
      ],
      "id": "b112b63b-1fc4-48f4-9951-3b04233bf30d",
      "name": "Google Drive11",
      "credentials": {
        "googleDriveOAuth2Api": {
          "id": "RHe6oZ7QoI8mqv4g",
          "name": "Google Drive account"
        }
      }
    },
    {
      "parameters": {
        "operation": "copy",
        "fileId": {
          "__rl": true,
          "value": "1QjHIfBo8LjbI-jJZroFwqK8A7ecPhlLCQRWmIz2A2bI",
          "mode": "list",
          "cachedResultName": "template",
          "cachedResultUrl": "https://docs.google.com/document/d/1QjHIfBo8LjbI-jJZroFwqK8A7ecPhlLCQRWmIz2A2bI/edit?usp=drivesdk"
        },
        "name": "2",
        "options": {}
      },
      "type": "n8n-nodes-base.googleDrive",
      "typeVersion": 3,
      "position": [
        4240,
        -420
      ],
      "id": "6165ac76-34a6-4370-897d-1e794db122c9",
      "name": "Google Drive1",
      "credentials": {
        "googleDriveOAuth2Api": {
          "id": "RHe6oZ7QoI8mqv4g",
          "name": "Google Drive account"
        }
      }
    },
    {
      "parameters": {
        "operation": "sendDocument",
        "chatId": "={{ $('Telegram Trigger').item.json.message.chat.id }}",
        "binaryData": true,
        "additionalFields": {
          "caption": "Invoice generated !",
          "fileName": "output.pdf"
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        5820,
        -420
      ],
      "id": "7776ff78-fb9d-475f-a275-aab16ee855ac",
      "name": "Telegram16",
      "webhookId": "ff72e35f-0754-4202-b38d-3e75fe7523db",
      "credentials": {
        "telegramApi": {
          "id": "RpCZHGbo8GY97ml6",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "operation": "copy",
        "fileId": {
          "__rl": true,
          "value": "1QjHIfBo8LjbI-jJZroFwqK8A7ecPhlLCQRWmIz2A2bI",
          "mode": "list",
          "cachedResultName": "template",
          "cachedResultUrl": "https://docs.google.com/document/d/1QjHIfBo8LjbI-jJZroFwqK8A7ecPhlLCQRWmIz2A2bI/edit?usp=drivesdk"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleDrive",
      "typeVersion": 3,
      "position": [
        3580,
        980
      ],
      "id": "332b1f9c-cdc5-420f-863a-9b402dd77bc2",
      "name": "Google Drive12",
      "credentials": {
        "googleDriveOAuth2Api": {
          "id": "RHe6oZ7QoI8mqv4g",
          "name": "Google Drive account"
        }
      }
    },
    {
      "parameters": {
        "operation": "copy",
        "fileId": {
          "__rl": true,
          "value": "1QjHIfBo8LjbI-jJZroFwqK8A7ecPhlLCQRWmIz2A2bI",
          "mode": "list",
          "cachedResultName": "template",
          "cachedResultUrl": "https://docs.google.com/document/d/1QjHIfBo8LjbI-jJZroFwqK8A7ecPhlLCQRWmIz2A2bI/edit?usp=drivesdk"
        },
        "name": "2",
        "options": {}
      },
      "type": "n8n-nodes-base.googleDrive",
      "typeVersion": 3,
      "position": [
        4140,
        -80
      ],
      "id": "6e6daad7-cefa-43c1-83b8-486427e044ec",
      "name": "Google Drive13",
      "credentials": {
        "googleDriveOAuth2Api": {
          "id": "RHe6oZ7QoI8mqv4g",
          "name": "Google Drive account"
        }
      }
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "loose",
                  "version": 2
                },
                "conditions": [
                  {
                    "leftValue": "={{ $json['Payment Status'] }}",
                    "rightValue": "Unpaid",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    },
                    "id": "68813e95-d105-4a53-bc43-a92ae275aaf3"
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "loose",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "465aa7fc-8b99-4417-900d-c0b1000cb9e8",
                    "leftValue": "={{ $json['Invoice No'] }}",
                    "rightValue": "",
                    "operator": {
                      "type": "string",
                      "operation": "exists",
                      "singleValue": true
                    }
                  }
                ],
                "combinator": "and"
              }
            }
          ]
        },
        "looseTypeValidation": true,
        "options": {
          "allMatchingOutputs": true
        }
      },
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3.2,
      "position": [
        6320,
        520
      ],
      "id": "ef19dac7-609f-4934-a731-db0f657d5fa7",
      "name": "Switch4"
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "=Use the following data:\n\n\nReceiver Email: {{ $json[\"Receiver Email\"] }}\nInvoice No: {{ $json[\"Invoice No\"] }}\nTotal Amount: {{ $json[\"Total Amount\"] }}\nDue Date: {{ $json[\"Due Date\"] }}\nPayment Status: {{ $json[\"Payment Status\"] }}\n\nOnly output the following three variables if the Payment Status is \"Unpaid\":\n\nrecipient: {{ $json[\"Receiver Email\"] }}\n\nsubject: Payment Reminder for Invoice {{ $json[\"Invoice No\"] }}\n\nbody: \nDear {{ $json[\"Name\"] }},<br><br>\nThis is a friendly reminder that your invoice #{{ $json[\"Invoice No\"] }} for ${{ $json[\"Total Amount\"] }} is still unpaid.<br><br>\nThe due date for this invoice is {{ $json[\"Due Date\"] }}. Please complete the payment at your earliest convenience.<br><br>\nIf you've already paid, kindly ignore this message.<br><br>\nBest regards,<br>\nYour Company Name\n",
        "options": {
          "systemMessage": "=You are an AI assistant that writes email content using structured data.\n\nYou receive invoice data from a Google Sheets node in n8n.\n\nYour job is to output exactly three individual variables — not JSON, not in markdown, not in code blocks.\n\nEach output must be separated and assigned:\n\nrecipient → the value of \"Receiver Email\"\n\nsubject → formatted using the \"Invoice No\" like: Payment Reminder for Invoice 12345\n\nbody → a fully formatted HTML string using Name, Invoice No, Total Amount, and Due Date\n\n⚠️ Do not generate any output if the Payment Status is not \"Unpaid\".\n\nYou are also a parser — ensure the values are split into the three variables below, with no wrapping and no missing fields.\n"
        }
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 1.9,
      "position": [
        6880,
        320
      ],
      "id": "708274ee-71b3-4803-9b98-8c6d714db3cc",
      "name": "Mail agent"
    },
    {
      "parameters": {
        "modelName": "models/gemini-1.5-flash-8b-latest",
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatGoogleGemini",
      "typeVersion": 1,
      "position": [
        6920,
        480
      ],
      "id": "fd033bf0-58fb-4aa5-b41c-6fbe50a0f67b",
      "name": "Google Gemini Chat Model4",
      "credentials": {
        "googlePalmApi": {
          "id": "oX6GN6LX2hphLuiB",
          "name": "Google Gemini(PaLM) Api account"
        }
      }
    },
    {
      "parameters": {
        "documentId": {
          "__rl": true,
          "value": "1lc3qFWiDDh_51-_iCbBtzJzDIui4lUHkkbF_zOkJn04",
          "mode": "list",
          "cachedResultName": "invoice",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lc3qFWiDDh_51-_iCbBtzJzDIui4lUHkkbF_zOkJn04/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": "gid=0",
          "mode": "list",
          "cachedResultName": "Sheet1",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lc3qFWiDDh_51-_iCbBtzJzDIui4lUHkkbF_zOkJn04/edit#gid=0"
        },
        "filtersUI": {
          "values": [
            {
              "lookupColumn": "Payment Status",
              "lookupValue": "Unpaid"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.6,
      "position": [
        6680,
        320
      ],
      "id": "bff575ff-673e-45bf-a9c5-cfde395da24a",
      "name": "Google Sheets11",
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "0QjhWLxNEbbsYTKu",
          "name": "Google Sheets account 3"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "const results = [];\n\nfor (const item of items) {\n  const rawText = item.json.output || \"\"; // Replace with correct field if needed\n\n  // Use regex to extract recipient, subject and body\n  const recipientMatch = rawText.match(/recipient\\s*:\\s*(.+)/i);\n  const subjectMatch = rawText.match(/subject\\s*:\\s*(.+)/i);\n  const bodyMatch = rawText.match(/body\\s*:\\s*([\\s\\S]*)/i);\n\n  const recipient = recipientMatch ? recipientMatch[1].trim() : '';\n  const subject = subjectMatch ? subjectMatch[1].trim() : '';\n  const body = bodyMatch ? bodyMatch[1].trim() : '';\n\n  results.push({\n    json: {\n      recipient,\n      subject,\n      body\n    }\n  });\n}\n\nreturn results;\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        7200,
        320
      ],
      "id": "cc0a1fc7-5096-4d43-a5e8-bd068f02ec79",
      "name": "Code16"
    },
    {
      "parameters": {
        "sendTo": "={{ $json.recipient }}",
        "subject": "={{ $json.subject }}",
        "message": "={{ $json.body }}",
        "options": {}
      },
      "type": "n8n-nodes-base.gmail",
      "typeVersion": 2.1,
      "position": [
        7380,
        320
      ],
      "id": "691715a8-50ff-492d-b676-184b5cb5b448",
      "name": "Gmail3",
      "webhookId": "872b6367-33e2-40e2-8098-063d8111b35d",
      "credentials": {
        "gmailOAuth2": {
          "id": "uhMuQUcOeIhyxhxM",
          "name": "Gmail account"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "// Create a map to count occurrences of each Invoice No\nconst invoiceCount = {};\n\nfor (const item of items) {\n  const SenderEmail = item.json['Sender Email'];\n  if (!SenderEmail) continue;\n\n  invoiceCount[SenderEmail] = (invoiceCount[SenderEmail] || 0) + 1;\n}\n\n// Filter to get only repeated invoice numbers\nconst duplicates = [];\n\nfor (const [SenderEmail, count] of Object.entries(invoiceCount)) {\n  if (count > 1) {\n    duplicates.push({\n      json: {\n        SenderEmail,\n        count\n      }\n    });\n  }\n}\n\nreturn duplicates;\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        6860,
        720
      ],
      "id": "b51a2c78-e4d2-4412-9fe1-95fa482ac90d",
      "name": "Code17"
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "=Use the following fields from each row of data:\n\n\n\nEmail: {{ $json['Sender Email'] }}\n\nInvoice No:{{ $json['Invoice No'] }}\n\nTotal Amount: {{ $json['Sub Total'] }}\n\nDue Date: 15 days after invoice generated\n\nCalculate Estimated Tax as 18% of Total Amount, and Approximate Total as Total + Tax.\n\nWrite an email with the following structure:\n\nTo:{{ $json['Receiver Email'] }}\n\nSubject: Clarification on Repeated Invoice #{{ $json['Invoice No'] }}\n\nBody:\n\nhtml\nCopy\nEdit\nDear Client ,<br><br>\nWe noticed that invoice # {{ $json['Invoice No'] }} has been generated more than once in our records.<br><br>\nIf you intended to request a repeat of this invoice, please confirm by replying to this message.<br><br>\nOriginal Amount(without tax): ${{ $json['Sub Total'] }}<br>\nEstimated Tax: {{ $json.Tax }}) $<br>\nApproximate Total:{{ $json['Sub Total'] }}+{{ $json.Tax }}<br><br>\nIf this was unintentional, please disregard or let us know so we can correct it.<br><br>\nThank you,<br>\nYour Company Name\n",
        "options": {
          "systemMessage": "=You are an AI email assistant embedded in an automated workflow (e.g., n8n).\nYou receive structured invoice data from a Google Sheets node.\n\nYour job is to generate email content only when an invoice number appears more than once in the data (indicating a possible duplicate or a repeat request).\n\nYou must output the following three variables as plain text (not JSON, code blocks, or markdown):\n\nrecipient: the customer’s email address\n\nsubject: a clear message referring to the repeated invoice\n\nbody: a polite HTML-formatted message that:\n\ninforms the client about the repeat invoice\n\nasks if they intentionally requested a repeat\n\nmentions the invoice amount and includes an estimated tax \n\navoids overly technical language\n\nends with a courteous sign-off\n\n⚠️ Do not generate output if the invoice appears only once. Only work with duplicates.\n\n"
        }
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 1.9,
      "position": [
        7920,
        720
      ],
      "id": "ef3d618e-e71c-4f1b-92ec-981d5f4fb1d1",
      "name": "Mail agent1"
    },
    {
      "parameters": {
        "modelName": "models/gemini-1.5-flash-latest",
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatGoogleGemini",
      "typeVersion": 1,
      "position": [
        8000,
        900
      ],
      "id": "4e0ee239-3c80-46fa-897f-6e10ac6a33d0",
      "name": "Google Gemini Chat Model5",
      "credentials": {
        "googlePalmApi": {
          "id": "oX6GN6LX2hphLuiB",
          "name": "Google Gemini(PaLM) Api account"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "const results = [];\nconst seen = new Set();\n\nfor (const item of items) {\n  const rawText = item.json.output || \"\"; // Replace with correct field if needed\n\n  // Use regex to extract recipient, subject and body\n  const recipientMatch = rawText.match(/recipient\\s*:\\s*(.+)/i);\n  const subjectMatch = rawText.match(/subject\\s*:\\s*(.+)/i);\n  const bodyMatch = rawText.match(/body\\s*:\\s*([\\s\\S]*)/i);\n\n  const recipient = recipientMatch ? recipientMatch[1].trim() : '';\n  const subject = subjectMatch ? subjectMatch[1].trim() : '';\n  const body = bodyMatch ? bodyMatch[1].trim() : '';\n\n  // Combine fields to form a unique key\n  const uniqueKey = `${recipient}_${subject}`;\n\n  if (!seen.has(uniqueKey)) {\n    seen.add(uniqueKey);\n    results.push({\n      json: {\n        recipient,\n        subject,\n        body\n      }\n    });\n  }\n}\n\nreturn results;\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        8340,
        720
      ],
      "id": "637bc320-e38c-48d6-8d34-62997b1bd478",
      "name": "Code18"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "031923c9-9651-4c0b-b3a7-d051a19350b5",
              "leftValue": "={{ $json.count }}",
              "rightValue": 1,
              "operator": {
                "type": "number",
                "operation": "gt"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        7080,
        720
      ],
      "id": "2a466f49-416f-4b15-be43-9201aa381c74",
      "name": "If1"
    },
    {
      "parameters": {
        "documentId": {
          "__rl": true,
          "value": "1lc3qFWiDDh_51-_iCbBtzJzDIui4lUHkkbF_zOkJn04",
          "mode": "list",
          "cachedResultName": "invoice",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lc3qFWiDDh_51-_iCbBtzJzDIui4lUHkkbF_zOkJn04/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": "gid=0",
          "mode": "list",
          "cachedResultName": "Sheet1",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lc3qFWiDDh_51-_iCbBtzJzDIui4lUHkkbF_zOkJn04/edit#gid=0"
        },
        "filtersUI": {
          "values": [
            {
              "lookupColumn": "Sender Email",
              "lookupValue": "={{ $json.SenderEmail }}"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.6,
      "position": [
        7320,
        700
      ],
      "id": "c2b67b79-9b3d-4b58-8bca-24122a324920",
      "name": "Google Sheets10",
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "0QjhWLxNEbbsYTKu",
          "name": "Google Sheets account 3"
        }
      }
    },
    {
      "parameters": {
        "operation": "append",
        "documentId": {
          "__rl": true,
          "value": "1lc3qFWiDDh_51-_iCbBtzJzDIui4lUHkkbF_zOkJn04",
          "mode": "list",
          "cachedResultName": "invoice",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lc3qFWiDDh_51-_iCbBtzJzDIui4lUHkkbF_zOkJn04/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": "gid=0",
          "mode": "list",
          "cachedResultName": "Sheet1",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lc3qFWiDDh_51-_iCbBtzJzDIui4lUHkkbF_zOkJn04/edit#gid=0"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "Sub Total": "={{ $json.subtotal }}",
            "Tax": "={{ $json.estimatedTax }}",
            "Total Amount": "={{ $json.approximateTotal }}",
            "Receiver Email": "={{ $('Code19').item.json['Receiver Email'] }}",
            "Receiver Phone No": "={{ $('Code19').item.json['Receiver Phone No'] }}",
            "Receiver Address": "={{ $('Code19').item.json['Receiver Address'] }}",
            "Sender  Banking details": "={{ $('Code19').item.json['Sender  Banking details'] }}",
            "Sender Email": "={{ $('Code19').item.json['Sender Email'] }}",
            "Sender Phone No": "={{ $('Code19').item.json['Sender Phone No'] }}",
            "Sender Address": "={{ $('Code19').item.json['Sender Address'] }}",
            "Invoice Date": "={{ $('Code19').item.json.InvoiceDate }}",
            "Invoice No": "={{ $('Code19').item.json.newInvoiceNo }}",
            "Due Date": "={{ $('Code19').item.json.DueDate }}",
            "Items": "={{ $json.Items }}"
          },
          "matchingColumns": [],
          "schema": [
            {
              "id": "Invoice No",
              "displayName": "Invoice No",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "Invoice Date",
              "displayName": "Invoice Date",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "Due Date",
              "displayName": "Due Date",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "Sender Address",
              "displayName": "Sender Address",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "Sender Phone No",
              "displayName": "Sender Phone No",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "Sender Email",
              "displayName": "Sender Email",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "Sender  Banking details",
              "displayName": "Sender  Banking details",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "Receiver Address",
              "displayName": "Receiver Address",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "Receiver Phone No",
              "displayName": "Receiver Phone No",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "Receiver Email",
              "displayName": "Receiver Email",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "Items",
              "displayName": "Items",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "Sub Total",
              "displayName": "Sub Total",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "Tax",
              "displayName": "Tax",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "Total Amount",
              "displayName": "Total Amount",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "Payment Status",
              "displayName": "Payment Status",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.6,
      "position": [
        10900,
        720
      ],
      "id": "23e924e8-b27d-4e4b-bd00-119702c99776",
      "name": "Google Sheets12",
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "0QjhWLxNEbbsYTKu",
          "name": "Google Sheets account 3"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "const results = [];\nconst seenInvoices = new Set();\nconst now = new Date();\nconst year = now.getFullYear();\nconst month = String(now.getMonth() + 1).padStart(2, '0');\nconst day = String(now.getDate()).padStart(2, '0');\nconst randomPart = Math.floor(Math.random() * 9000 + 1000);\nconst newInvoiceNo = `INV-${year}${month}${day}-${randomPart}`;\n\n// Format date helper\nconst formatDate = (date) => {\n  return date.toLocaleDateString('en-GB'); // DD/MM/YYYY\n};\n\nconst today = new Date();\nconst dueDate = new Date(today);\ndueDate.setDate(today.getDate() + 15);\n\nconst invoiceDateStr = formatDate(today);\nconst dueDateStr = formatDate(dueDate);\n\nfor (const item of items) {\n  const invoiceNo = item.json['Invoice No'];\n  if (!invoiceNo || seenInvoices.has(invoiceNo)) {\n    continue;\n  }\n\n  seenInvoices.add(invoiceNo);\n\n  results.push({\n    json: {\n      ...item.json,\n      newInvoiceNo, // <- comma fixed here\n      InvoiceDate: invoiceDateStr,\n      DueDate: dueDateStr\n    }\n  });\n}\n\nreturn results;\n\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        9900,
        700
      ],
      "id": "480137f7-598c-44a0-8fc4-0913aaca6885",
      "name": "Code19"
    },
    {
      "parameters": {
        "jsCode": "const results = [];\n\nfor (const item of items) {\n  const rawText =  $('Mail agent1').first().json.output|| '';\n\n  // Improved function to extract amounts using flexible label matching\n  const extractAmount = (label) => {\n    const regex = new RegExp(`${label}\\\\s*[:\\\\-]?\\\\s*\\\\$?([\\\\d,.,]+)`, 'i');\n    const match = rawText.match(regex);\n    if (match) {\n      return parseFloat(match[1].replace(/,/g, '').trim());\n    }\n    return null;\n  };\n\n  // Try multiple common label formats just in case\n  const estimatedTax = extractAmount('Estimated Tax') || extractAmount('Tax');\n  const approximateTotal = extractAmount('Approximate Total') || extractAmount('Total');\n\n  const subtotal = (approximateTotal !== null && estimatedTax !== null)\n    ? parseFloat((approximateTotal - estimatedTax).toFixed(2))\n    : null;\n\n  results.push({\n    json: {\n      ...item.json,\n      subtotal,\n      estimatedTax,\n      approximateTotal\n    }\n  });\n}\n\nreturn results;\n\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        10600,
        720
      ],
      "id": "f789d81a-8a4c-4d15-9a3e-5e46583df953",
      "name": "Code20"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "b1874647-8e1c-458f-b9e3-0c6eeeb143b2",
              "name": "invoice_no",
              "value": "={{ $('Code20').item.json.newInvoiceNo }}",
              "type": "string"
            },
            {
              "id": "9257b427-0dfc-4d53-a5d4-13e8d9ec7345",
              "name": "date",
              "value": "={{ $('Code20').item.json.InvoiceDate }}",
              "type": "string"
            },
            {
              "id": "41fa45e3-6447-4ec0-aa62-1aefe8e146a6",
              "name": "duedate",
              "value": "={{ $('Code20').item.json.DueDate }}",
              "type": "string"
            },
            {
              "id": "bffe988d-eb23-4425-917a-a226296808df",
              "name": "sender_address1",
              "value": "={{ $('Code20').item.json['Sender Address'] }}",
              "type": "string"
            },
            {
              "id": "5dc85229-31f0-4229-9b86-7a2d38397a14",
              "name": "sender_email",
              "value": "={{ $('Code20').item.json['Sender Email'] }}",
              "type": "string"
            },
            {
              "id": "003abfdb-b7ab-43a9-877e-1f4063752c31",
              "name": "sender_phone",
              "value": "={{ $('Code20').item.json['Sender Phone No'] }}",
              "type": "string"
            },
            {
              "id": "2d271723-3c5a-4422-8a3e-54af9fd9311d",
              "name": "rece_addess1",
              "value": "={{ $('Code20').item.json['Receiver Address'] }}",
              "type": "string"
            },
            {
              "id": "2dcd2f24-ebe2-4c7f-8196-18f0463ac044",
              "name": "rece_phone",
              "value": "={{ $('Code20').item.json['Receiver Phone No'] }}",
              "type": "string"
            },
            {
              "id": "31084748-ef2e-425d-9976-632299bbbf47",
              "name": "rece_email",
              "value": "={{ $('Code20').item.json['Receiver Email'] }}",
              "type": "string"
            },
            {
              "id": "6d3d613a-8dee-4b1c-9e3c-2d401049dea1",
              "name": "subtotal",
              "value": "={{ $('Code20').item.json['Sub Total'] }}",
              "type": "number"
            },
            {
              "id": "fe889203-2816-4ba1-a09b-893e5bc0cccb",
              "name": "tax",
              "value": "={{ $('Code20').item.json.Tax }}",
              "type": "number"
            },
            {
              "id": "c2deeb88-73e7-48df-8ccf-8561f51400bc",
              "name": "total",
              "value": "={{ $('Code20').item.json['Total Amount'] }}",
              "type": "number"
            },
            {
              "id": "2dc30727-d3e7-4e69-afb6-81208ea3855c",
              "name": "items",
              "value": "={{ $json.items }}",
              "type": "array"
            }
          ]
        },
        "options": {
          "ignoreConversionErrors": false
        }
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        11520,
        720
      ],
      "id": "21306b2f-b92c-40d2-9611-122000354440",
      "name": "Edit Fields8"
    },
    {
      "parameters": {
        "jsCode": "// Helpers\nconst safeNumber = (val) => {\n  if (val == null || isNaN(val)) return 0;\n  return Number(val);\n};\nconst safeString = (val) => (val == null ? '' : String(val).trim());\n\n// Get and decode binary data\nconst base64Data = items[0].binary?.data?.data;\nif (!base64Data) throw new Error('Binary \"data\" not found');\n\nconst decodedJson = Buffer.from(base64Data, 'base64').toString('utf8');\nconst parsedArray = JSON.parse(decodedJson); // Array of invoices\n\n// Use first invoice only\nconst invoice = parsedArray[0];\n\n// Normalize items array\nconst allItems = Array.isArray(invoice.items)\n  ? invoice.items.reduce((acc, val) => acc.concat(val), [])\n  : [];\n\nconst transformedItems = allItems.map((item) => {\n  const quantity = safeNumber(item.quantity ?? item.unit);\n  const unitPrice = safeNumber(item.unit_price ?? item.unitPrice ?? item.unit_Price);\n  const totalAmount = safeNumber(\n    item.total ??\n    item.total_price ??\n    item.total_amount ??\n    item.amount\n  ) || (quantity * unitPrice);\n\n  return {\n    description: safeString(item.description ?? item.item_name ?? item.name),\n    quantity,\n    unit_price: unitPrice,\n    total_amount: totalAmount\n  };\n});\n\n// Final normalized invoice object using values from the binary\nconst transformedInvoice = {\n  invoice_no: safeString(invoice.invoice_number ?? invoice.invoice_no),\n  date: safeString(invoice.invoice_date ?? invoice.date),\n  duedate: safeString(invoice.due_date ?? invoice.duedate),\n  sender_address1: safeString(invoice.sender_address1 ?? invoice.seller),\n  sender_email: safeString(invoice.sender_email ?? ''),\n  sender_phone: safeString(invoice.sender_phone ?? ''),\n  rece_addess1: safeString(invoice.rece_addess1 ?? invoice.buyer),\n  rece_email: safeString(invoice.rece_email ?? ''),\n  rece_phone: safeString(invoice.rece_phone ?? ''),\n  items: transformedItems,\n  subtotal: safeNumber(invoice.subtotal ?? invoice.sub_total ?? invoice['Sub Total']).toFixed(2),\n  tax: safeNumber(invoice.tax ?? invoice['Tax']).toFixed(2),\n  total: safeNumber(invoice.total ?? invoice['Total Amount']).toFixed(2)\n};\n\nreturn [{ json: transformedInvoice }];\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        11840,
        720
      ],
      "id": "397e4472-670f-43d5-b0be-98e9c7ad96ba",
      "name": "Code25"
    },
    {
      "parameters": {
        "url": "https://docs.googleapis.com/v1/documents/1QjHIfBo8LjbI-jJZroFwqK8A7ecPhlLCQRWmIz2A2bI",
        "authentication": "predefinedCredentialType",
        "nodeCredentialType": "googleDocsOAuth2Api",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {}
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        11980,
        720
      ],
      "id": "6acb31e5-2936-40a9-8093-40c03a624d60",
      "name": "HTTP Request8",
      "credentials": {
        "googleDocsOAuth2Api": {
          "id": "5U2uokXrTrdFYjWn",
          "name": "Google Docs account"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "// 🔹 Function to extract placeholders from Google Docs body.content\nfunction extractPlaceholdersFromContent(contentArray) {\n  const placeholders = new Set();\n\n  function extractFromText(text) {\n    const matches = [...text.matchAll(/{{(.*?)}}/g)];\n    matches.forEach(m => placeholders.add(m[1]));\n  }\n\n  function extractFromParagraph(paragraph) {\n    for (const el of paragraph.elements || []) {\n      if (el.textRun?.content) {\n        extractFromText(el.textRun.content);\n      }\n    }\n  }\n\n  function extractFromTable(table) {\n    for (const row of table.tableRows || []) {\n      for (const cell of row.tableCells || []) {\n        for (const block of cell.content || []) {\n          if (block.paragraph) {\n            extractFromParagraph(block.paragraph);\n          }\n        }\n      }\n    }\n  }\n\n  for (const block of contentArray || []) {\n    if (block.paragraph) {\n      extractFromParagraph(block.paragraph);\n    } else if (block.table) {\n      extractFromTable(block.table);\n    }\n  }\n\n  return Array.from(placeholders);\n}\n\n// 🔹 Function to map invoice data to known placeholder structure\nfunction mapInvoiceToPlaceholders($json) {\n  const invoice = $json\n\n  const mappedData = {\n    sender_address: invoice.sender_address1 || '',\n    sender_phone: invoice.sender_phone || '',\n    sender_email: invoice.sender_email || '',\n\n    rece_address: invoice.rece_addess1 || '',\n    rece_phone: invoice.rece_phone || '',\n    rece_email: invoice.rece_email || '',\n\n    invoice_no: invoice.invoice_no || '',\n    date: invoice.date || '',\n    duedate: invoice.duedate || '',\n\n    subtotal: invoice.subtotal ?? 0,\n    tax: invoice.tax ?? 0,\n    total: invoice.total ?? 0,\n    notes: invoice.notes || ''\n  };\n\n  const maxItems = 7;\n  const items = invoice.items || [];\n\n  for (let i = 0; i < maxItems; i++) {\n    const itemIndex = i + 1;\n    const item = items[i] || {};\n\n    mappedData[`item_${itemIndex}_name`] = item.description || '';\n    mappedData[`item_${itemIndex}_qty`] = item.quantity ?? 0;\n    mappedData[`item_${itemIndex}_unit_price`] = item.unit_price ?? 0;\n    mappedData[`item_${itemIndex}_total`] = item.total_amount ?? 0;\n  }\n\n  return mappedData;\n}\n\n// 🔹 Main logic for n8n — process each input item\nreturn $input.all().map(item => {\n  const data = item.json;\n\n  // If Google Docs content exists, extract placeholders\n  if (data.body?.content) {\n    data.placeholders = extractPlaceholdersFromContent(data.body.content);\n  }\n\n  const mapped = mapInvoiceToPlaceholders(data);\n\n  return { json: mapped };\n});\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        12480,
        720
      ],
      "id": "5f265604-0028-46f7-aa61-d7ce97d2640b",
      "name": "Code26"
    },
    {
      "parameters": {
        "jsCode": "// Get all items (array) from \"Code4\"\nconst data = $items(\"Code25\", 0);\n\n// Simply return them as-is\nreturn data;\n\n\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        12320,
        720
      ],
      "id": "a278c700-66f0-452b-b264-5e8b35733495",
      "name": "Code27"
    },
    {
      "parameters": {
        "operation": "toJson",
        "options": {}
      },
      "type": "n8n-nodes-base.convertToFile",
      "typeVersion": 1.1,
      "position": [
        11660,
        720
      ],
      "id": "448dd807-9b14-4868-95f2-5a0e21679800",
      "name": "Convert to File4"
    },
    {
      "parameters": {
        "method": "POST",
        "url": "=https://docs.googleapis.com/v1/documents/{{ $('Google Drive19').item.json.id }}:batchUpdate\n\n",
        "authentication": "predefinedCredentialType",
        "nodeCredentialType": "googleDocsOAuth2Api",
        "sendBody": true,
        "bodyParameters": {
          "parameters": [
            {
              "name": "requests",
              "value": "={{$json.requests}}"
            }
          ]
        },
        "options": {
          "batching": {
            "batch": {
              "batchSize": 50,
              "batchInterval": 1000
            }
          },
          "response": {}
        }
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        12760,
        720
      ],
      "id": "6f24780d-2a9c-48c8-99ee-439e878376be",
      "name": "HTTP Request9",
      "credentials": {
        "googleDocsOAuth2Api": {
          "id": "5U2uokXrTrdFYjWn",
          "name": "Google Docs account"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "const values = $json;\nconst requests = [];\n\nfor (const [key, value] of Object.entries(values)) {\n  requests.push({\n    replaceAllText: {\n      containsText: {\n        text: `{{${key}}}`,\n        matchCase: true\n      },\n      replaceText: value.toString()\n    }\n  });\n}\n\nreturn [{ json: { requests } }];\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        12620,
        720
      ],
      "id": "49b21691-2214-4442-b662-e50ace3a9f4a",
      "name": "Code28"
    },
    {
      "parameters": {
        "operation": "download",
        "fileId": {
          "__rl": true,
          "value": "={{ $('Google Drive19').item.json.id }}",
          "mode": "id"
        },
        "options": {
          "googleFileConversion": {
            "conversion": {
              "docsToFormat": "application/pdf"
            }
          },
          "fileName": "pdf"
        }
      },
      "type": "n8n-nodes-base.googleDrive",
      "typeVersion": 3,
      "position": [
        12920,
        720
      ],
      "id": "7941a03e-2cc4-4803-9c74-4d3aaac52b62",
      "name": "Google Drive17",
      "credentials": {
        "googleDriveOAuth2Api": {
          "id": "RHe6oZ7QoI8mqv4g",
          "name": "Google Drive account"
        }
      }
    },
    {
      "parameters": {
        "driveId": {
          "__rl": true,
          "mode": "list",
          "value": "My Drive"
        },
        "folderId": {
          "__rl": true,
          "mode": "list",
          "value": "root",
          "cachedResultName": "/ (Root folder)"
        },
        "options": {
          "simplifyOutput": true
        }
      },
      "type": "n8n-nodes-base.googleDrive",
      "typeVersion": 3,
      "position": [
        13080,
        720
      ],
      "id": "2ce91e99-acaa-4a12-beba-c77f4df7ac3b",
      "name": "Google Drive18",
      "credentials": {
        "googleDriveOAuth2Api": {
          "id": "RHe6oZ7QoI8mqv4g",
          "name": "Google Drive account"
        }
      }
    },
    {
      "parameters": {},
      "type": "n8n-nodes-base.wait",
      "typeVersion": 1.1,
      "position": [
        5100,
        980
      ],
      "id": "5655d7a2-000e-40ca-9032-3ef0b5fe2492",
      "name": "Wait1",
      "webhookId": "b4beb6e1-f13c-4bbf-84e8-ab34006bdeac"
    },
    {
      "parameters": {
        "operation": "download",
        "fileId": {
          "__rl": true,
          "value": "={{ $json.id }}",
          "mode": "id"
        },
        "options": {
          "googleFileConversion": {
            "conversion": {
              "docsToFormat": "application/pdf"
            }
          },
          "fileName": "pdf"
        }
      },
      "type": "n8n-nodes-base.googleDrive",
      "typeVersion": 3,
      "position": [
        4940,
        980
      ],
      "id": "e4ec8445-b025-4794-9353-f26047d825a4",
      "name": "Google Drive6",
      "credentials": {
        "googleDriveOAuth2Api": {
          "id": "RHe6oZ7QoI8mqv4g",
          "name": "Google Drive account"
        }
      }
    },
    {
      "parameters": {
        "driveId": {
          "__rl": true,
          "mode": "list",
          "value": "My Drive"
        },
        "folderId": {
          "__rl": true,
          "mode": "list",
          "value": "root",
          "cachedResultName": "/ (Root folder)"
        },
        "options": {
          "simplifyOutput": true
        }
      },
      "type": "n8n-nodes-base.googleDrive",
      "typeVersion": 3,
      "position": [
        4740,
        980
      ],
      "id": "3d916d83-00f3-43cb-b45d-667f79ab30c9",
      "name": "Google Drive5",
      "credentials": {
        "googleDriveOAuth2Api": {
          "id": "RHe6oZ7QoI8mqv4g",
          "name": "Google Drive account"
        }
      }
    },
    {
      "parameters": {
        "operation": "download",
        "fileId": {
          "__rl": true,
          "value": "={{ $('Google Drive12').item.json.id }}",
          "mode": "id"
        },
        "options": {
          "googleFileConversion": {
            "conversion": {
              "docsToFormat": "application/pdf"
            }
          },
          "fileName": "pdf"
        }
      },
      "type": "n8n-nodes-base.googleDrive",
      "typeVersion": 3,
      "position": [
        4600,
        980
      ],
      "id": "b89ceaf6-c325-4f95-a2af-f3ecfa7f9189",
      "name": "Google Drive4",
      "credentials": {
        "googleDriveOAuth2Api": {
          "id": "RHe6oZ7QoI8mqv4g",
          "name": "Google Drive account"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "const values = $json;\nconst requests = [];\n\nfor (const [key, value] of Object.entries(values)) {\n  requests.push({\n    replaceAllText: {\n      containsText: {\n        text: `{{${key}}}`,\n        matchCase: true\n      },\n      replaceText: value.toString()\n    }\n  });\n}\n\nreturn [{ json: { requests } }];\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        4180,
        980
      ],
      "id": "5bbd6f03-260c-4c7d-befb-7910efcda96a",
      "name": "Code9"
    },
    {
      "parameters": {
        "method": "POST",
        "url": "=https://docs.googleapis.com/v1/documents/{{ $('Google Drive12').item.json.id }}:batchUpdate\n\n",
        "authentication": "predefinedCredentialType",
        "nodeCredentialType": "googleDocsOAuth2Api",
        "sendBody": true,
        "bodyParameters": {
          "parameters": [
            {
              "name": "requests",
              "value": "={{$json.requests}}"
            }
          ]
        },
        "options": {
          "batching": {
            "batch": {
              "batchSize": 50,
              "batchInterval": 1000
            }
          },
          "response": {}
        }
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        4400,
        980
      ],
      "id": "9619bd38-6b96-416b-80df-cfdefef97879",
      "name": "HTTP Request1",
      "credentials": {
        "googleDocsOAuth2Api": {
          "id": "5U2uokXrTrdFYjWn",
          "name": "Google Docs account"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "// Get all items (array) from \"Code4\"\nconst data = $items(\"Code4\", 0);\n\n// Simply return them as-is\nreturn data;\n\n\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        3780,
        980
      ],
      "id": "8d049027-bbe3-40e4-92fa-df14de98251f",
      "name": "Code8"
    },
    {
      "parameters": {
        "jsCode": "// 🔹 Function to extract placeholders from Google Docs body.content\nfunction extractPlaceholdersFromContent(contentArray) {\n  const placeholders = new Set();\n\n  function extractFromText(text) {\n    const matches = [...text.matchAll(/{{(.*?)}}/g)];\n    matches.forEach(m => placeholders.add(m[1]));\n  }\n\n  function extractFromParagraph(paragraph) {\n    for (const el of paragraph.elements || []) {\n      if (el.textRun?.content) {\n        extractFromText(el.textRun.content);\n      }\n    }\n  }\n\n  function extractFromTable(table) {\n    for (const row of table.tableRows || []) {\n      for (const cell of row.tableCells || []) {\n        for (const block of cell.content || []) {\n          if (block.paragraph) {\n            extractFromParagraph(block.paragraph);\n          }\n        }\n      }\n    }\n  }\n\n  for (const block of contentArray || []) {\n    if (block.paragraph) {\n      extractFromParagraph(block.paragraph);\n    } else if (block.table) {\n      extractFromTable(block.table);\n    }\n  }\n\n  return Array.from(placeholders);\n}\n\n// 🔹 Function to map invoice data to known placeholder structure\nfunction mapInvoiceToPlaceholders($json) {\n  const invoice = $json\n\n  const mappedData = {\n    sender_address: invoice.sender_address1 || '',\n    sender_phone: invoice.sender_phone || '',\n    sender_email: invoice.sender_email || '',\n\n    rece_address: invoice.rece_addess1 || '',\n    rece_phone: invoice.rece_phone || '',\n    rece_email: invoice.rece_email || '',\n\n    invoice_no: invoice.invoice_no || '',\n    date: invoice.date || '',\n    duedate: invoice.duedate || '',\n\n    subtotal: invoice.subtotal ?? 0,\n    tax: invoice.tax ?? 0,\n    total: invoice.total ?? 0,\n    notes: invoice.notes || ''\n  };\n\n  const maxItems = 7;\n  const items = invoice.items || [];\n\n  for (let i = 0; i < maxItems; i++) {\n    const itemIndex = i + 1;\n    const item = items[i] || {};\n\n    mappedData[`item_${itemIndex}_name`] = item.item_name || '';\n    mappedData[`item_${itemIndex}_qty`] = item.unit ?? 0;\n    mappedData[`item_${itemIndex}_unit_price`] = item.unit_price ?? 0;\n    mappedData[`item_${itemIndex}_total`] = item.total ?? 0;\n  }\n\n  return mappedData;\n}\n\n// 🔹 Main logic for n8n — process each input item\nreturn $input.all().map(item => {\n  const data = item.json;\n\n  // If Google Docs content exists, extract placeholders\n  if (data.body?.content) {\n    data.placeholders = extractPlaceholdersFromContent(data.body.content);\n  }\n\n  const mapped = mapInvoiceToPlaceholders(data);\n\n  return { json: mapped };\n});\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        3960,
        980
      ],
      "id": "c219c20d-c42f-481f-82af-0e1c2716b364",
      "name": "Code7"
    },
    {
      "parameters": {
        "operation": "sendDocument",
        "chatId": "={{ $('Telegram Trigger').item.json.message.chat.id }}",
        "binaryData": true,
        "additionalFields": {
          "caption": "Invoice generated !",
          "fileName": "output.pdf"
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        5240,
        980
      ],
      "id": "8a196edb-ef5e-4cb5-b1f5-3a7f72f20460",
      "name": "Telegram15",
      "webhookId": "ff72e35f-0754-4202-b38d-3e75fe7523db",
      "credentials": {
        "telegramApi": {
          "id": "RpCZHGbo8GY97ml6",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "sendTo": "={{ $('Google Sheets12').item.json['Receiver Email'] }}",
        "subject": "Confirmed Invoice!",
        "message": "The invoice for the confirmed details is below:",
        "options": {
          "attachmentsUi": {
            "attachmentsBinary": [
              {
                "property": "=data"
              }
            ]
          }
        }
      },
      "type": "n8n-nodes-base.gmail",
      "typeVersion": 2.1,
      "position": [
        13440,
        720
      ],
      "id": "d41a8d26-22e1-4b1c-894d-ee703d714039",
      "name": "Gmail",
      "webhookId": "e5caf856-23e7-4c29-89fa-b8b00cebbd32",
      "credentials": {
        "gmailOAuth2": {
          "id": "uhMuQUcOeIhyxhxM",
          "name": "Gmail account"
        }
      }
    },
    {
      "parameters": {
        "operation": "download",
        "fileId": {
          "__rl": true,
          "value": "={{ $json.id }}",
          "mode": "id"
        },
        "options": {
          "googleFileConversion": {
            "conversion": {
              "docsToFormat": "application/pdf"
            }
          },
          "fileName": "pdf"
        }
      },
      "type": "n8n-nodes-base.googleDrive",
      "typeVersion": 3,
      "position": [
        13260,
        720
      ],
      "id": "f9c64c2d-ce95-49f4-b931-c6e4bbd799b3",
      "name": "Google Drive14",
      "credentials": {
        "googleDriveOAuth2Api": {
          "id": "RHe6oZ7QoI8mqv4g",
          "name": "Google Drive account"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "const hashMap = new Map();\nconst duplicates = new Set();\nconst results = [];\n\n// Group by row content (excluding row_number)\nfor (const item of items) {\n  const { row_number, ...rest } = item.json;\n  const key = JSON.stringify(rest);\n\n  if (hashMap.has(key)) {\n    duplicates.add(key);\n  } else {\n    hashMap.set(key, item);\n  }\n}\n\n// Return only one row per duplicate group\nfor (const key of duplicates) {\n  results.push({ json: hashMap.get(key).json });\n}\n\nreturn results;\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        7540,
        700
      ],
      "id": "1da6d47e-17b8-4284-88c6-7fa25ccc69f0",
      "name": "Code29"
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "n8n-nodes-base.splitInBatches",
      "typeVersion": 3,
      "position": [
        8560,
        720
      ],
      "id": "e8cf9aff-d44c-4b18-9819-17f6bc3abfe5",
      "name": "Loop Over Items"
    },
    {
      "parameters": {
        "operation": "sendAndWait",
        "sendTo": "={{ $json.recipient }}",
        "subject": "={{ $json.subject }}",
        "message": "={{ $json.body }}",
        "approvalOptions": {
          "values": {
            "approvalType": "double"
          }
        },
        "options": {}
      },
      "type": "n8n-nodes-base.gmail",
      "typeVersion": 2.1,
      "position": [
        8980,
        840
      ],
      "id": "7c99e55e-57f0-4a92-9370-6861c2799551",
      "name": "Gmail4",
      "webhookId": "872b6367-33e2-40e2-8098-063d8111b35d",
      "credentials": {
        "gmailOAuth2": {
          "id": "uhMuQUcOeIhyxhxM",
          "name": "Gmail account"
        }
      }
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "n8n-nodes-base.splitInBatches",
      "typeVersion": 3,
      "position": [
        10140,
        720
      ],
      "id": "b29bb83e-39c0-437b-b92f-175b7ac617c9",
      "name": "Loop Over Items1"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "loose",
            "version": 2
          },
          "conditions": [
            {
              "id": "4996c4fd-7a3b-4d3f-bfdd-3dba76030123",
              "leftValue": "={{ $json.data.approved }}",
              "rightValue": "true",
              "operator": {
                "type": "string",
                "operation": "equals",
                "name": "filter.operator.equals"
              }
            }
          ],
          "combinator": "and"
        },
        "looseTypeValidation": true,
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        8780,
        620
      ],
      "id": "0f6708a3-c491-4b2a-a727-21befd591975",
      "name": "If2"
    },
    {
      "parameters": {
        "documentId": {
          "__rl": true,
          "value": "1lc3qFWiDDh_51-_iCbBtzJzDIui4lUHkkbF_zOkJn04",
          "mode": "list",
          "cachedResultName": "invoice",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lc3qFWiDDh_51-_iCbBtzJzDIui4lUHkkbF_zOkJn04/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": "gid=0",
          "mode": "list",
          "cachedResultName": "Sheet1",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lc3qFWiDDh_51-_iCbBtzJzDIui4lUHkkbF_zOkJn04/edit#gid=0"
        },
        "filtersUI": {
          "values": [
            {
              "lookupColumn": "Receiver Email",
              "lookupValue": "={{ $('Code18').item.json.recipient }}"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.6,
      "position": [
        9000,
        520
      ],
      "id": "928380d0-2902-4def-a933-35f985658e3b",
      "name": "Google Sheets14",
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "0QjhWLxNEbbsYTKu",
          "name": "Google Sheets account 3"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "const hashMap = new Map();\nconst duplicates = new Set();\nconst results = [];\n\n// Group by row content (excluding row_number)\nfor (const item of items) {\n  const { row_number, ...rest } = item.json;\n  const key = JSON.stringify(rest);\n\n  if (hashMap.has(key)) {\n    duplicates.add(key);\n  } else {\n    hashMap.set(key, item);\n  }\n}\n\n// Return only one row per duplicate group\nfor (const key of duplicates) {\n  results.push({ json: hashMap.get(key).json });\n}\nreturn results;"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        9220,
        520
      ],
      "id": "29712c57-f6aa-424e-9d02-79ac19d4b800",
      "name": "Code21"
    },
    {
      "parameters": {
        "jsCode": "const rawText = 'Software Development, Qty: 1, Unit Price: ₹75000, Total: ₹75000';\n\n// Use RegEx to extract fields\nconst match = rawText.match(/^(.*?),\\s*Qty:\\s*(\\d+),\\s*Unit Price:\\s*₹([\\d,]+),\\s*Total:\\s*₹([\\d,]+)/);\n\nif (!match) {\n  throw new Error('Input string format not recognized');\n}\n\n// Convert extracted strings into structured data\nconst item = {\n  description: match[1].trim(),\n  quantity: parseInt(match[2]),\n  unit_price: parseInt(match[3].replace(/,/g, '')),\n  total: parseInt(match[4].replace(/,/g, ''))\n};\n\n// Return as one array named `items`\nreturn [{ json: { items: [item] } }];\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        11120,
        720
      ],
      "id": "2e52b706-168e-49c5-9696-64fcbd9312a7",
      "name": "Code22"
    },
    {
      "parameters": {
        "operation": "copy",
        "fileId": {
          "__rl": true,
          "value": "1QjHIfBo8LjbI-jJZroFwqK8A7ecPhlLCQRWmIz2A2bI",
          "mode": "list",
          "cachedResultName": "template",
          "cachedResultUrl": "https://docs.google.com/document/d/1QjHIfBo8LjbI-jJZroFwqK8A7ecPhlLCQRWmIz2A2bI/edit?usp=drivesdk"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleDrive",
      "typeVersion": 3,
      "position": [
        12180,
        720
      ],
      "id": "f78f5003-8c58-48a3-b331-1a1da6c72c87",
      "name": "Google Drive19",
      "credentials": {
        "googleDriveOAuth2Api": {
          "id": "RHe6oZ7QoI8mqv4g",
          "name": "Google Drive account"
        }
      }
    }
  ],
  "pinData": {},
  "connections": {
    "Telegram Trigger": {
      "main": [
        [
          {
            "node": "Switch",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Switch": {
      "main": [
        [
          {
            "node": "Edit Fields3",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Edit Fields2",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Switch2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Telegram": {
      "main": [
        [
          {
            "node": "Telegram1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Telegram1": {
      "main": [
        [
          {
            "node": "Upload to Llama Parse",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Upload to Llama Parse": {
      "main": [
        [
          {
            "node": "Get Processing Status",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get Processing Status": {
      "main": [
        [
          {
            "node": "Switch1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Switch1": {
      "main": [
        [
          {
            "node": "Get Parsed Invoice Data",
            "type": "main",
            "index": 0
          }
        ],
        [],
        [],
        [
          {
            "node": "Wait",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Wait": {
      "main": [
        [
          {
            "node": "Get Processing Status",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get Parsed Invoice Data": {
      "main": [
        [
          {
            "node": "Basic LLM Chain",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Google Gemini Chat Model": {
      "ai_languageModel": [
        [
          {
            "node": "Basic LLM Chain",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Basic LLM Chain": {
      "main": [
        [
          {
            "node": "Code",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code": {
      "main": [
        [
          {
            "node": "Google Sheets",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Google Sheets": {
      "main": [
        [
          {
            "node": "Telegram2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Telegram2": {
      "main": [
        [
          {
            "node": "Edit Fields5",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Telegram8": {
      "main": [
        [
          {
            "node": "Telegram9",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Telegram9": {
      "main": [
        [
          {
            "node": "Upload to Llama Parse2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get Processing Status2": {
      "main": [
        [
          {
            "node": "Switch3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Upload to Llama Parse2": {
      "main": [
        [
          {
            "node": "Get Processing Status2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Switch3": {
      "main": [
        [
          {
            "node": "Get Parsed Invoice Data2",
            "type": "main",
            "index": 0
          }
        ],
        [],
        [],
        [
          {
            "node": "Wait2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Wait2": {
      "main": [
        [
          {
            "node": "Get Processing Status2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get Parsed Invoice Data2": {
      "main": [
        [
          {
            "node": "Basic LLM Chain2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Basic LLM Chain2": {
      "main": [
        [
          {
            "node": "Code2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Google Gemini Chat Model2": {
      "ai_languageModel": [
        [
          {
            "node": "Basic LLM Chain2",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Code2": {
      "main": [
        [
          {
            "node": "Google Sheets1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Google Sheets1": {
      "main": [
        [
          {
            "node": "Telegram4",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Telegram4": {
      "main": [
        [
          {
            "node": "Edit Fields4",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Google Sheets3": {
      "main": [
        [
          {
            "node": "Google Drive2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Sort": {
      "main": [
        [
          {
            "node": "Limit",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Limit": {
      "main": [
        [
          {
            "node": "Google Drive3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Edit Fields": {
      "main": [
        [
          {
            "node": "Google Sheets4",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Google Sheets4": {
      "main": [
        [
          {
            "node": "Limit1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Limit1": {
      "main": [
        [
          {
            "node": "Edit Fields1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Edit Fields1": {
      "main": [
        [
          {
            "node": "Google Sheets5",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Google Sheets5": {
      "main": [
        [
          {
            "node": "Telegram6",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Telegram6": {
      "main": [
        []
      ]
    },
    "Telegram10": {
      "main": [
        [
          {
            "node": "Google Sheets2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Google Sheets2": {
      "main": [
        [
          {
            "node": "Google Sheets3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Google Drive2": {
      "main": [
        [
          {
            "node": "Sort",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Edit Fields2": {
      "main": [
        [
          {
            "node": "Telegram",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Edit Fields3": {
      "main": [
        [
          {
            "node": "Telegram8",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Switch2": {
      "main": [
        [
          {
            "node": "Telegram7",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Telegram10",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Edit Fields",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "AI Agent",
            "type": "main",
            "index": 0
          }
        ],
        []
      ]
    },
    "Edit Fields4": {
      "main": [
        [
          {
            "node": "Convert to File",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Convert to File": {
      "main": [
        [
          {
            "node": "Code5",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code5": {
      "main": [
        [
          {
            "node": "HTTP Request4",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Edit Fields5": {
      "main": [
        [
          {
            "node": "Convert to File1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Convert to File1": {
      "main": [
        [
          {
            "node": "Code6",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code6": {
      "main": [
        [
          {
            "node": "HTTP Request2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Google Sheets6": {
      "main": [
        [
          {
            "node": "Switch4",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Schedule Trigger": {
      "main": [
        [
          {
            "node": "Google Sheets6",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Google Sheets7": {
      "main": [
        [
          {
            "node": "Switch4",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Schedule Trigger1": {
      "main": [
        [
          {
            "node": "Google Sheets7",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Google Gemini Chat Model1": {
      "ai_languageModel": [
        [
          {
            "node": "AI Agent",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "AI Agent": {
      "main": [
        [
          {
            "node": "Telegram3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Telegram3": {
      "main": [
        [
          {
            "node": "Code3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Google Gemini Chat Model3": {
      "ai_languageModel": [
        [
          {
            "node": "Basic LLM Chain1",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Basic LLM Chain1": {
      "main": [
        [
          {
            "node": "Code1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code1": {
      "main": [
        [
          {
            "node": "Google Sheets8",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Google Sheets8": {
      "main": [
        [
          {
            "node": "Edit Fields6",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Edit Fields6": {
      "main": [
        [
          {
            "node": "Convert to File2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code4": {
      "main": [
        [
          {
            "node": "HTTP Request",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Google Sheets9": {
      "main": [
        [
          {
            "node": "Switch4",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Schedule Trigger2": {
      "main": [
        [
          {
            "node": "Google Sheets9",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If": {
      "main": [
        [
          {
            "node": "Basic LLM Chain1",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "No Operation, do nothing",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code3": {
      "main": [
        [
          {
            "node": "If",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Simple Memory": {
      "ai_memory": [
        [
          {
            "node": "AI Agent",
            "type": "ai_memory",
            "index": 0
          }
        ]
      ]
    },
    "HTTP Request": {
      "main": [
        [
          {
            "node": "Google Drive12",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Convert to File2": {
      "main": [
        [
          {
            "node": "Code4",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "HTTP Request2": {
      "main": [
        [
          {
            "node": "Google Drive13",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code10": {
      "main": [
        [
          {
            "node": "Code12",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code11": {
      "main": [
        [
          {
            "node": "Code10",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "HTTP Request3": {
      "main": [
        [
          {
            "node": "Google Drive7",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code12": {
      "main": [
        [
          {
            "node": "HTTP Request3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Google Drive7": {
      "main": [
        [
          {
            "node": "Google Drive8",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Google Drive8": {
      "main": [
        [
          {
            "node": "Google Drive9",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Google Drive9": {
      "main": [
        [
          {
            "node": "Google Sheets7",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "HTTP Request4": {
      "main": [
        [
          {
            "node": "Google Drive1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code13": {
      "main": [
        [
          {
            "node": "Code15",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code14": {
      "main": [
        [
          {
            "node": "Code13",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "HTTP Request5": {
      "main": [
        [
          {
            "node": "Google Drive",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code15": {
      "main": [
        [
          {
            "node": "HTTP Request5",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Google Drive": {
      "main": [
        [
          {
            "node": "Google Drive10",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Google Drive10": {
      "main": [
        [
          {
            "node": "Google Drive11",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Google Drive11": {
      "main": [
        [
          {
            "node": "Telegram16",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Google Drive1": {
      "main": [
        [
          {
            "node": "Code14",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Telegram16": {
      "main": [
        [
          {
            "node": "Google Sheets6",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Google Drive12": {
      "main": [
        [
          {
            "node": "Code8",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Google Drive13": {
      "main": [
        [
          {
            "node": "Code11",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Switch4": {
      "main": [
        [
          {
            "node": "Google Sheets11",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Code17",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Google Gemini Chat Model4": {
      "ai_languageModel": [
        [
          {
            "node": "Mail agent",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Google Sheets11": {
      "main": [
        [
          {
            "node": "Mail agent",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Mail agent": {
      "main": [
        [
          {
            "node": "Code16",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code16": {
      "main": [
        [
          {
            "node": "Gmail3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code17": {
      "main": [
        [
          {
            "node": "If1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Mail agent1": {
      "main": [
        [
          {
            "node": "Code18",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Google Gemini Chat Model5": {
      "ai_languageModel": [
        [
          {
            "node": "Mail agent1",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Code18": {
      "main": [
        [
          {
            "node": "Loop Over Items",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If1": {
      "main": [
        [
          {
            "node": "Google Sheets10",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Google Sheets10": {
      "main": [
        [
          {
            "node": "Code29",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code19": {
      "main": [
        [
          {
            "node": "Loop Over Items1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code20": {
      "main": [
        [
          {
            "node": "Google Sheets12",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Edit Fields8": {
      "main": [
        [
          {
            "node": "Convert to File4",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code25": {
      "main": [
        [
          {
            "node": "HTTP Request8",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "HTTP Request8": {
      "main": [
        [
          {
            "node": "Google Drive19",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code26": {
      "main": [
        [
          {
            "node": "Code28",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code27": {
      "main": [
        [
          {
            "node": "Code26",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Convert to File4": {
      "main": [
        [
          {
            "node": "Code25",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "HTTP Request9": {
      "main": [
        [
          {
            "node": "Google Drive17",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code28": {
      "main": [
        [
          {
            "node": "HTTP Request9",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Google Drive17": {
      "main": [
        [
          {
            "node": "Google Drive18",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Google Sheets12": {
      "main": [
        [
          {
            "node": "Code22",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Wait1": {
      "main": [
        [
          {
            "node": "Telegram15",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Google Drive6": {
      "main": [
        [
          {
            "node": "Wait1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Google Drive5": {
      "main": [
        [
          {
            "node": "Google Drive6",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Google Drive4": {
      "main": [
        [
          {
            "node": "Google Drive5",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code9": {
      "main": [
        [
          {
            "node": "HTTP Request1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "HTTP Request1": {
      "main": [
        [
          {
            "node": "Google Drive4",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code8": {
      "main": [
        [
          {
            "node": "Code7",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code7": {
      "main": [
        [
          {
            "node": "Code9",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Telegram15": {
      "main": [
        [
          {
            "node": "Google Sheets9",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Google Drive18": {
      "main": [
        [
          {
            "node": "Google Drive14",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Google Drive14": {
      "main": [
        [
          {
            "node": "Gmail",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code29": {
      "main": [
        [
          {
            "node": "Mail agent1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Loop Over Items": {
      "main": [
        [
          {
            "node": "If2",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Gmail4",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Gmail4": {
      "main": [
        [
          {
            "node": "Loop Over Items",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Loop Over Items1": {
      "main": [
        [],
        [
          {
            "node": "Code20",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Gmail": {
      "main": [
        [
          {
            "node": "Loop Over Items1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If2": {
      "main": [
        [
          {
            "node": "Google Sheets14",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Google Sheets14": {
      "main": [
        [
          {
            "node": "Code21",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code21": {
      "main": [
        [
          {
            "node": "Code19",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code22": {
      "main": [
        [
          {
            "node": "Edit Fields8",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Google Drive19": {
      "main": [
        [
          {
            "node": "Code27",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "active": false,
  "settings": {
    "executionOrder": "v1"
  },
  "versionId": "090dff01-8246-4a39-91c8-de4409b3d557",
  "meta": {
    "templateCredsSetupCompleted": true,
    "instanceId": "2e1c4872beeffdf78b70f93919a78694991855471adc8e807e9177792fb0b393"
  },
  "id": "Rl0QwHcXHqSpU0Qf",
  "tags": []
}